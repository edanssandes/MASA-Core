<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MASA-Core: AbstractBlockAligner.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MASA-Core
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">AbstractBlockAligner.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AbstractBlockAligner_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (c) 2010-2015   Edans Sandes</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of MASA-Core.</span>
<a name="l00006"></a>00006 <span class="comment"> * </span>
<a name="l00007"></a>00007 <span class="comment"> * MASA-Core is free software: you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment"> * (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"> * </span>
<a name="l00012"></a>00012 <span class="comment"> * MASA-Core is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"> * </span>
<a name="l00017"></a>00017 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment"> * along with MASA-Core.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> ******************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="AbstractBlockAligner_8hpp.html">AbstractBlockAligner.hpp</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html">config.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;../processors/CPUBlockProcessor.hpp&quot;</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">/**</span>
<a name="l00032"></a>00032 <span class="comment"> * Set to (1) in order to print debug information in the stdout. This</span>
<a name="l00033"></a>00033 <span class="comment"> * significantly degrades the performance.</span>
<a name="l00034"></a>00034 <span class="comment"> */</span>
<a name="l00035"></a><a class="code" href="AbstractBlockAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">00035</a> <span class="preprocessor">#define DEBUG (0)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="comment">/*</span>
<a name="l00038"></a>00038 <span class="comment"> * The score constants</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a><a class="code" href="AbstractBlockAligner_8cpp.html#af49fa91d527822b0b73095f617a7c294">00040</a> <span class="preprocessor">#define DNA_MATCH       (1)</span>
<a name="l00041"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a33a761d36373a0119dc15f26f7669143">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define DNA_MISMATCH    (-3)</span>
<a name="l00042"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a651759c49a5944667d613fb10aeac0c6">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define DNA_GAP_EXT     (2)</span>
<a name="l00043"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a67ed15bd34b549091bae40172c6fb4d1">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define DNA_GAP_OPEN    (3)</span>
<a name="l00044"></a><a class="code" href="AbstractBlockAligner_8cpp.html#af573c29b2e2503ceedbf6bce6359ef1e">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define DNA_GAP_FIRST   (DNA_GAP_EXT+DNA_GAP_OPEN)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#ifdef ENABLE_PROFILING</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#include &quot;../libs/masa-core/src/common/Timer.hpp&quot;</span>
<a name="l00049"></a>00049 <span class="keyword">static</span> FILE* bitmap = NULL;
<a name="l00050"></a>00050 <span class="preprocessor">#define PROFILING_INIT(name) bitmap = fopen(name, &quot;wt&quot;);</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#define PROFILING_TIME(var) float var = Timer::getGlobalTime();</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#define PROFILING_PRINT(bx, by, score, done, time) fprintf(bitmap, &quot;%d %d %d %d %d %p\n&quot;, by, bx, score, done, (int)((time)*1000), pthread_self());</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00054"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a0a1735c10a4e543f3f89532c4ee5b1c4">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define PROFILING_INIT</span>
<a name="l00055"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a835e0b611544b36c9d273e9dee8740bd">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define PROFILING_TIME(var)</span>
<a name="l00056"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a54f678eae310e54e606a252133ec87e0">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define PROFILING_PRINT(bx, by, score, done, time)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">/**</span>
<a name="l00060"></a>00060 <span class="comment"> * Maximum recommended block size for better performance</span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a9c9e19200046307a362d7d548c5d5109">00062</a> <span class="preprocessor">#define RECOMMENDED_BLOCK_SIZE  (1024)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">/**</span>
<a name="l00065"></a>00065 <span class="comment"> * Minimum recommended grid size for better performance</span>
<a name="l00066"></a>00066 <span class="comment"> */</span>
<a name="l00067"></a><a class="code" href="AbstractBlockAligner_8cpp.html#a5747f69fe0efdfb6227ebc5a74f3275c">00067</a> <span class="preprocessor">#define RECOMMENDED_GRID_SIZE   (8)</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">/**</span>
<a name="l00071"></a>00071 <span class="comment"> * AbstractBlockAligner Constructor.</span>
<a name="l00072"></a>00072 <span class="comment"> */</span>
<a name="l00073"></a><a class="code" href="classAbstractBlockAligner.html#a8b8fab077391ae017b036f0b4f40a90a">00073</a> <a class="code" href="classAbstractBlockAligner.html#a8b8fab077391ae017b036f0b4f40a90a" title="Constructor.">AbstractBlockAligner::AbstractBlockAligner</a>(<a class="code" href="classAbstractBlockProcessor.html">AbstractBlockProcessor</a>* blockProcessor, <a class="code" href="classBlockAlignerParameters.html" title="This class contains the parameters for the AbstractBlockAligner.">BlockAlignerParameters</a>* params) {
<a name="l00074"></a>00074         <span class="comment">/*</span>
<a name="l00075"></a>00075 <span class="comment">         * Initializations</span>
<a name="l00076"></a>00076 <span class="comment">         */</span>
<a name="l00077"></a>00077         <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a> = NULL;
<a name="l00078"></a>00078         <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a> = NULL;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="comment">/*</span>
<a name="l00081"></a>00081 <span class="comment">         *  defines the constant parameters to be returned in the</span>
<a name="l00082"></a>00082 <span class="comment">         *  getScoreParameters() method</span>
<a name="l00083"></a>00083 <span class="comment">         */</span>
<a name="l00084"></a>00084         <a class="code" href="classAbstractBlockAligner.html#afa9583be61915e6169db1c619aa29a5b" title="Score parameters.">score_params</a>.<a class="code" href="structscore__params__t.html#af5fe25b32fe7dba5ac51d19647e291f6" title="match score (positive).">match</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#af49fa91d527822b0b73095f617a7c294">DNA_MATCH</a>;
<a name="l00085"></a>00085         <a class="code" href="classAbstractBlockAligner.html#afa9583be61915e6169db1c619aa29a5b" title="Score parameters.">score_params</a>.<a class="code" href="structscore__params__t.html#ada2f394fa7603342e238404aac1b67e8" title="mismatch penalty (negative).">mismatch</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#a33a761d36373a0119dc15f26f7669143">DNA_MISMATCH</a>;
<a name="l00086"></a>00086         <a class="code" href="classAbstractBlockAligner.html#afa9583be61915e6169db1c619aa29a5b" title="Score parameters.">score_params</a>.<a class="code" href="structscore__params__t.html#af1560959abbdd01509c2bdfddfd2bb9f" title="gap opening penalty (positive).">gap_open</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#a67ed15bd34b549091bae40172c6fb4d1">DNA_GAP_OPEN</a>;
<a name="l00087"></a>00087         <a class="code" href="classAbstractBlockAligner.html#afa9583be61915e6169db1c619aa29a5b" title="Score parameters.">score_params</a>.<a class="code" href="structscore__params__t.html#ad67dde287a30bb053f2a8c77b27f2815" title="gap extension penalty (positive).">gap_ext</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#a651759c49a5944667d613fb10aeac0c6">DNA_GAP_EXT</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">/*</span>
<a name="l00090"></a>00090 <span class="comment">         * creates the custom parameters</span>
<a name="l00091"></a>00091 <span class="comment">         */</span>
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (params == NULL) {
<a name="l00093"></a>00093                 this-&gt;params = <span class="keyword">new</span> <a class="code" href="classBlockAlignerParameters.html" title="This class contains the parameters for the AbstractBlockAligner.">BlockAlignerParameters</a>();
<a name="l00094"></a>00094         } <span class="keywordflow">else</span> {
<a name="l00095"></a>00095                 this-&gt;params = <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>;
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097         <span class="keywordflow">if</span> (blockProcessor == NULL) {
<a name="l00098"></a>00098                 this-&gt;blockProcessor = <span class="keyword">new</span> <a class="code" href="classCPUBlockProcessor.html">CPUBlockProcessor</a>();
<a name="l00099"></a>00099         } <span class="keywordflow">else</span> {
<a name="l00100"></a>00100                 this-&gt;blockProcessor = <a class="code" href="classAbstractBlockAligner.html#a16af3780c84a8f5ab08b20d74efce1b3" title="Processor that computes a single block.">blockProcessor</a>;
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102         this-&gt;<a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a> = <span class="keyword">new</span> <a class="code" href="classBlockPruningGenericN2.html">BlockPruningGenericN2</a>();
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="comment">/*</span>
<a name="l00105"></a>00105 <span class="comment">         * Must be called to enable --fork parameter. This will allow</span>
<a name="l00106"></a>00106 <span class="comment">         * 2 process for each CPU. Each process will receive the same</span>
<a name="l00107"></a>00107 <span class="comment">         * workload.</span>
<a name="l00108"></a>00108 <span class="comment">         */</span>
<a name="l00109"></a>00109         <span class="keywordtype">int</span> numCPU = sysconf( _SC_NPROCESSORS_ONLN );
<a name="l00110"></a>00110         <a class="code" href="classAbstractAligner.html#a15085bdaa0b4f829a34db0b5dd55e202" title="Defines how many processes may be forked for this aligner and the computation weight for each process...">setForkCount</a>(numCPU*2);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <a class="code" href="classAbstractBlockAligner.html#a0619b27f6a298192d1b6cd193299b351" title="Preferred maximum size of a block.">preferredBlockSize</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#a9c9e19200046307a362d7d548c5d5109" title="Maximum recommended block size for better performance.">RECOMMENDED_BLOCK_SIZE</a>;
<a name="l00113"></a>00113         <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a> = <a class="code" href="AbstractBlockAligner_8cpp.html#a5747f69fe0efdfb6227ebc5a74f3275c" title="Minimum recommended grid size for better performance.">RECOMMENDED_GRID_SIZE</a>;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 <span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment">/**</span>
<a name="l00117"></a>00117 <span class="comment"> * AbstractBlockAligner destructor.</span>
<a name="l00118"></a>00118 <span class="comment"> */</span>
<a name="l00119"></a><a class="code" href="classAbstractBlockAligner.html#a1be93523bc2ed6ad9aab4a33896ebe64">00119</a> <a class="code" href="classAbstractBlockAligner.html#a1be93523bc2ed6ad9aab4a33896ebe64" title="Destructor.">AbstractBlockAligner::~AbstractBlockAligner</a>() {
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/*</span>
<a name="l00123"></a>00123 <span class="comment"> * This method defines which capabilities are implemented by this aligner.</span>
<a name="l00124"></a>00124 <span class="comment"> * The dispatch_special_column and variable_penalties capabilities are</span>
<a name="l00125"></a>00125 <span class="comment"> * not used yet by the MASA framework. The block_pruning and dispatch_last_cell</span>
<a name="l00126"></a>00126 <span class="comment"> * capabilities are not supported yet by this example aligner.</span>
<a name="l00127"></a>00127 <span class="comment"> */</span>
<a name="l00128"></a><a class="code" href="classAbstractBlockAligner.html#aa309daf581c9582ac52d50b9333201a3">00128</a> <a class="code" href="structaligner__capabilities__t.html" title="Struct that informs to the MASA framework which capabilities the MASA extension implements.">aligner_capabilities_t</a> <a class="code" href="classAbstractBlockAligner.html#aa309daf581c9582ac52d50b9333201a3" title="Returns the capabilities of the aligner.">AbstractBlockAligner::getCapabilities</a>() {
<a name="l00129"></a>00129         <a class="code" href="structaligner__capabilities__t.html" title="Struct that informs to the MASA framework which capabilities the MASA extension implements.">aligner_capabilities_t</a> capabilities;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <span class="comment">/* This is the supported capabilities of this Aligner subclass */</span>
<a name="l00132"></a>00132         capabilities.<a class="code" href="structaligner__capabilities__t.html#a2ac5b1fe5ceda691eedb34749df8e81a" title="Aligns with the Smith wWaterman (SW) recurrence function.">smith_waterman</a>                     = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00133"></a>00133         capabilities.<a class="code" href="structaligner__capabilities__t.html#a950cfd0f57ef24bb09694bc392d15fda" title="Aligns with the Needleman Wunsch (NW) recurrence function.">needleman_wunsch</a>                   = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00134"></a>00134         capabilities.<a class="code" href="structaligner__capabilities__t.html#a6bf472877cd29334840925f1ba618051" title="Implements the block pruning optimization.">block_pruning</a>                              = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00135"></a>00135         capabilities.<a class="code" href="structaligner__capabilities__t.html#a098706f2e7fe2882f5aad3509e04b432" title="Initializes the first column with custom data.">customize_first_column</a>     = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00136"></a>00136         capabilities.<a class="code" href="structaligner__capabilities__t.html#a69cf17db6302a2954752976fb2f9ebc0" title="Initializes the first row with custom data.">customize_first_row</a>                = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00137"></a>00137         capabilities.<a class="code" href="structaligner__capabilities__t.html#a9ca7738d34226962386ebc39283977f6" title="Dispatches the last cell of the partition using the IManager::dispatchScore method.">dispatch_last_cell</a>                 = <a class="code" href="capabilities_8hpp.html#a0d001f8e1945076dfdb7fdddfd8e0391" title="Use this constant for the unsupported capabilities by the Aligner.">NOT_SUPPORTED</a>;
<a name="l00138"></a>00138         capabilities.<a class="code" href="structaligner__capabilities__t.html#ade156877216f1a3ea0076899ef08fd8f" title="Dispatches the last column of the partition using the IManager::dispatchColumn method.">dispatch_last_column</a>               = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00139"></a>00139         capabilities.<a class="code" href="structaligner__capabilities__t.html#a3e314bcaaa13a86c2b3b65ec28c15875" title="Dispatches the last row of the partition using the IManager::dispatchRow method.">dispatch_last_row</a>                  = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00140"></a>00140         capabilities.<a class="code" href="structaligner__capabilities__t.html#a5075e781b8e4a6f0b5564d1f106119b2" title="Dispatches special columns using the IManager::dispatchColumn method.">dispatch_special_column</a>    = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00141"></a>00141         capabilities.<a class="code" href="structaligner__capabilities__t.html#a30958dcec456f3c722320d3b66f9ace8" title="Dispatches special rows using the IManager::dispatchRow method.">dispatch_special_row</a>               = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00142"></a>00142         capabilities.<a class="code" href="structaligner__capabilities__t.html#a6894b92fb6480c2cfe920f38f312a95e" title="Dispatches scores in a regular block pattern.">dispatch_block_scores</a>              = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00143"></a>00143         capabilities.<a class="code" href="structaligner__capabilities__t.html#a927e9d789fed352557c22b0359876fad" title="Dispatches more than one score using the IManager::dispatchScore method.">dispatch_scores</a>                    = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00144"></a>00144         capabilities.<a class="code" href="structaligner__capabilities__t.html#acf4503aa271a5107961db454ac4c9219" title="Aligns only the region delimited by the partition .">process_partition</a>                  = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00145"></a>00145         capabilities.<a class="code" href="structaligner__capabilities__t.html#a411da46278df91cd4b189bb4245b30f9" title="Aligns using variable penalties.">variable_penalties</a>                 = <a class="code" href="capabilities_8hpp.html#a0d001f8e1945076dfdb7fdddfd8e0391" title="Use this constant for the unsupported capabilities by the Aligner.">NOT_SUPPORTED</a>;
<a name="l00146"></a>00146         capabilities.<a class="code" href="structaligner__capabilities__t.html#a83281303d5ef7cb65e451606c128382b" title="Allows the execution of many forked processes in parallel.">fork_processes</a>                             = <a class="code" href="capabilities_8hpp.html#afec1cc32eb66fe0bbc0bb2fae11b5eb9" title="Use this constant for the supported capabilities by the Aligner.">SUPPORTED</a>;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         capabilities.<a class="code" href="structaligner__capabilities__t.html#ab2ac785f2c0585b2036a2d5dc4c7a209" title="Indicates the maximum allowed size for the vertical sequence (seq0).">maximum_seq0_len</a>   = 0;
<a name="l00149"></a>00149         capabilities.<a class="code" href="structaligner__capabilities__t.html#a163380f4d551c2ca30d0caf0e6214bd2" title="Indicates the maximum allowed size for the horizontal sequence (seq1) Zero-value means unlimited size...">maximum_seq1_len</a>   = 0;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">return</span> capabilities;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">/*</span>
<a name="l00155"></a>00155 <span class="comment"> * Returns the constant match/mismatch/gaps scores.</span>
<a name="l00156"></a>00156 <span class="comment"> */</span>
<a name="l00157"></a><a class="code" href="classAbstractBlockAligner.html#afcbc31db09f30fcf7ecaad90d41a4486">00157</a> <span class="keyword">const</span> <a class="code" href="structscore__params__t.html" title="Defines the match/mismatch score and affine gap penalties.">score_params_t</a>* <a class="code" href="classAbstractBlockAligner.html#afcbc31db09f30fcf7ecaad90d41a4486" title="Returns the match/mismatch parameters and the gap penalties used by this IAligner.">AbstractBlockAligner::getScoreParameters</a>() {
<a name="l00158"></a>00158         <span class="keywordflow">return</span> &amp;<a class="code" href="classAbstractBlockAligner.html#afa9583be61915e6169db1c619aa29a5b" title="Score parameters.">score_params</a>;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">/*</span>
<a name="l00162"></a>00162 <span class="comment"> * See MicParameters and AbstractAlignerParameters classes.</span>
<a name="l00163"></a>00163 <span class="comment"> */</span>
<a name="l00164"></a><a class="code" href="classAbstractBlockAligner.html#a2b971d7e35ff46435d143450c81057cb">00164</a> <a class="code" href="classIAlignerParameters.html" title="The customized parameters of a MASA Extension, used for receiving, manipulating and customizing comma...">IAlignerParameters</a>* <a class="code" href="classAbstractBlockAligner.html#a2b971d7e35ff46435d143450c81057cb" title="Get the command line parameters of the IAligner class.">AbstractBlockAligner::getParameters</a>() {
<a name="l00165"></a>00165         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>;
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="comment">/*</span>
<a name="l00169"></a>00169 <span class="comment"> * Initializes some structures of the Aligner. This method</span>
<a name="l00170"></a>00170 <span class="comment"> * is called only once for each stage, and only the sequence data may be</span>
<a name="l00171"></a>00171 <span class="comment"> * obtained in this time. The parameters must also be used here.</span>
<a name="l00172"></a>00172 <span class="comment"> * The partition boundaries must only be used in the alignPartition() method.</span>
<a name="l00173"></a>00173 <span class="comment"> *</span>
<a name="l00174"></a>00174 <span class="comment"> * See the IAligner and AbstractAligner classes documentation.</span>
<a name="l00175"></a>00175 <span class="comment"> */</span>
<a name="l00176"></a><a class="code" href="classAbstractBlockAligner.html#abf514ee30854ef29c0bb177ef380d656">00176</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#abf514ee30854ef29c0bb177ef380d656" title="Initializes the Aligner before the execution of the alignment procedure.">AbstractBlockAligner::initialize</a>() {
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment">/*</span>
<a name="l00181"></a>00181 <span class="comment"> * The finalize method is called once for each stage, right before</span>
<a name="l00182"></a>00182 <span class="comment"> * the printFinalStatistics. Here we must deallocate all the previously</span>
<a name="l00183"></a>00183 <span class="comment"> * allocated structure.</span>
<a name="l00184"></a>00184 <span class="comment"> *</span>
<a name="l00185"></a>00185 <span class="comment"> * See the IAligner and AbstractAligner classes documentation.</span>
<a name="l00186"></a>00186 <span class="comment"> */</span>
<a name="l00187"></a><a class="code" href="classAbstractBlockAligner.html#a9e24f99f9dc64163b892fdf8f270dd9e">00187</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a9e24f99f9dc64163b892fdf8f270dd9e" title="Finalizes the execution of this IAligner.">AbstractBlockAligner::finalize</a>() {
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>() != NULL) {
<a name="l00189"></a>00189                 <a class="code" href="classAbstractBlockAligner.html#a8cafc87a29fa63b85e7cf3c0867ae792" title="Deallocate vectors after sequence is unset.">deallocateStructures</a>();
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment"></span>
<a name="l00194"></a>00194 <span class="comment">/**</span>
<a name="l00195"></a>00195 <span class="comment"> * Configures the grid for the given partition.</span>
<a name="l00196"></a>00196 <span class="comment"> * @param partition partition to be aligned.</span>
<a name="l00197"></a>00197 <span class="comment"> */</span>
<a name="l00198"></a><a class="code" href="classAbstractBlockAligner.html#a9651ac81f014c0e79a2ee66bcfdad91a">00198</a> <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractBlockAligner.html#a9651ac81f014c0e79a2ee66bcfdad91a" title="Configures the grid for the given partition.">AbstractBlockAligner::configureGrid</a>(<a class="code" href="classPartition.html">Partition</a> partition) {
<a name="l00199"></a>00199         <span class="comment">/* creates the grid */</span>
<a name="l00200"></a>00200         <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a> = this-&gt;<a class="code" href="classAbstractAligner.html#a10740e19e79a256a6e8459b43bf8b30d" title="Creates a new grid using the given partition coordinates.">createGrid</a>(partition);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         grid-&gt;<a class="code" href="classGrid.html#a3f5cd266d4dbb65d201b2009d7602833">setMinBlockSize</a>(<a class="code" href="BlockAlignerParameters_8hpp.html#ac1f29ba54415975a2fa23e276fdf8a0f">MIN_BLOCK_SIZE</a>, <a class="code" href="BlockAlignerParameters_8hpp.html#ac1f29ba54415975a2fa23e276fdf8a0f">MIN_BLOCK_SIZE</a>);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="comment">/* Block/Grid height */</span>
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#ab3431f0d2b3f9ab7628dcf651864cc3d">getBlockHeight</a>() &gt; 0) {
<a name="l00206"></a>00206                 grid-&gt;<a class="code" href="classGrid.html#afbd38a26067aafa773f25f1fd5ab5d2c">setBlockHeight</a>(<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#ab3431f0d2b3f9ab7628dcf651864cc3d">getBlockHeight</a>());
<a name="l00207"></a>00207         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a2681770d130f33791f4d2f7540c87c7f">getGridHeight</a>() &gt; 0) {
<a name="l00208"></a>00208                 grid-&gt;<a class="code" href="classGrid.html#afc7c87b3414d64c6cb8bb4c4a0fa4692" title="Splits the grid in $count$ positions (vertically).">splitGridVertically</a>(<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a2681770d130f33791f4d2f7540c87c7f">getGridHeight</a>());
<a name="l00209"></a>00209         } <span class="keywordflow">else</span> {
<a name="l00210"></a>00210                 <span class="comment">// Automatic configuration</span>
<a name="l00211"></a>00211                 <span class="keywordflow">if</span> (!<a class="code" href="classAbstractAligner.html#a93948e510ed96e7f0480275cafd423a8" title="Delegates to IManager::mustDispatchLastColumn()">mustDispatchLastColumn</a>()) {
<a name="l00212"></a>00212                         <span class="keywordtype">int</span> height = <a class="code" href="classAbstractBlockAligner.html#a0619b27f6a298192d1b6cd193299b351" title="Preferred maximum size of a block.">preferredBlockSize</a>;
<a name="l00213"></a>00213                         <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classGrid.html#a509082e18b37f4751223142672b9f811">getHeight</a>() / height &lt; <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>) {
<a name="l00214"></a>00214                                 height = grid-&gt;<a class="code" href="classGrid.html#a509082e18b37f4751223142672b9f811">getHeight</a>() / <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>;
<a name="l00215"></a>00215                         }
<a name="l00216"></a>00216                         grid-&gt;<a class="code" href="classGrid.html#afbd38a26067aafa773f25f1fd5ab5d2c">setBlockHeight</a>(height);
<a name="l00217"></a>00217                 } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218                         grid-&gt;<a class="code" href="classGrid.html#afbd38a26067aafa773f25f1fd5ab5d2c">setBlockHeight</a>(grid-&gt;<a class="code" href="classGrid.html#ad462aaf5448b0b69930d0a6fa1a4d34f">getWidth</a>()/<a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>/2);
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <span class="comment">/* Block/Grid width */</span>
<a name="l00223"></a>00223         <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a60a4f5c86983606178949979fbe596b0">getBlockWidth</a>() &gt; 0) {
<a name="l00224"></a>00224                 grid-&gt;<a class="code" href="classGrid.html#af96f6133be48d92ad6e9aa50c8082175">setBlockWidth</a>(<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a60a4f5c86983606178949979fbe596b0">getBlockWidth</a>());
<a name="l00225"></a>00225         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#aabdda3d80a7aacb811bc3501f854212d">getGridWidth</a>() &gt; 0) {
<a name="l00226"></a>00226                 grid-&gt;<a class="code" href="classGrid.html#a17b9c9e0d698b7c16d430fb5c478ff7c" title="Splits the grid in $count$ positions (horizontal).">splitGridHorizontally</a>(<a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#aabdda3d80a7aacb811bc3501f854212d">getGridWidth</a>());
<a name="l00227"></a>00227         } <span class="keywordflow">else</span> {
<a name="l00228"></a>00228                 <span class="comment">// Automatic configuration</span>
<a name="l00229"></a>00229                 <span class="keywordflow">if</span> (!<a class="code" href="classAbstractAligner.html#a93948e510ed96e7f0480275cafd423a8" title="Delegates to IManager::mustDispatchLastColumn()">mustDispatchLastColumn</a>()) {
<a name="l00230"></a>00230                         <span class="keywordtype">int</span> width = <a class="code" href="classAbstractBlockAligner.html#a0619b27f6a298192d1b6cd193299b351" title="Preferred maximum size of a block.">preferredBlockSize</a>;
<a name="l00231"></a>00231                         <span class="keywordflow">if</span> (grid-&gt;<a class="code" href="classGrid.html#ad462aaf5448b0b69930d0a6fa1a4d34f">getWidth</a>() / width &lt; <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>) {
<a name="l00232"></a>00232                                 width = grid-&gt;<a class="code" href="classGrid.html#ad462aaf5448b0b69930d0a6fa1a4d34f">getWidth</a>() / <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>;
<a name="l00233"></a>00233                         }
<a name="l00234"></a>00234                         grid-&gt;<a class="code" href="classGrid.html#af96f6133be48d92ad6e9aa50c8082175">setBlockWidth</a>(width);
<a name="l00235"></a>00235                 } <span class="keywordflow">else</span> {
<a name="l00236"></a>00236                         grid-&gt;<a class="code" href="classGrid.html#a17b9c9e0d698b7c16d430fb5c478ff7c" title="Splits the grid in $count$ positions (horizontal).">splitGridHorizontally</a>(<a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>);
<a name="l00237"></a>00237                 }
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="comment">/* block statistics */</span>
<a name="l00241"></a>00241         <span class="keywordtype">int</span> block_width  = grid-&gt;<a class="code" href="classGrid.html#a4201fba476e65ff6a874194de99a9f58">getBlockWidth</a>(0,0);
<a name="l00242"></a>00242         <span class="keywordtype">int</span> block_height = grid-&gt;<a class="code" href="classGrid.html#a369cbe9bb179f13ad37588da6bf764a9">getBlockHeight</a>(0,0);
<a name="l00243"></a>00243         <a class="code" href="classAbstractBlockAligner.html#af6dbf5905ab9a1db30a067f5d8c3e931" title="Maintains the minimum blockWidth used.">statMinBlockWidth</a>  = std::min(<a class="code" href="classAbstractBlockAligner.html#af6dbf5905ab9a1db30a067f5d8c3e931" title="Maintains the minimum blockWidth used.">statMinBlockWidth</a> , block_width);
<a name="l00244"></a>00244         <a class="code" href="classAbstractBlockAligner.html#a7b4528410736bbdf703232554845031e" title="Maintains the minimum blockHeight used.">statMinBlockHeight</a> = std::min(<a class="code" href="classAbstractBlockAligner.html#a7b4528410736bbdf703232554845031e" title="Maintains the minimum blockHeight used.">statMinBlockHeight</a>, block_height);
<a name="l00245"></a>00245         <a class="code" href="classAbstractBlockAligner.html#a5cdcb31f77690cfdda1111f9833095bd" title="Maintains the maximum blockWidth used.">statMaxBlockWidth</a>  = std::max(<a class="code" href="classAbstractBlockAligner.html#a5cdcb31f77690cfdda1111f9833095bd" title="Maintains the maximum blockWidth used.">statMaxBlockWidth</a> , block_width);
<a name="l00246"></a>00246         <a class="code" href="classAbstractBlockAligner.html#a271ac9f80e82e5487c59c57a8abb4cbb" title="Maintains the maximum blockHeight used.">statMaxBlockHeight</a> = std::max(<a class="code" href="classAbstractBlockAligner.html#a271ac9f80e82e5487c59c57a8abb4cbb" title="Maintains the maximum blockHeight used.">statMaxBlockHeight</a>, block_height);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="comment">/* grid statistics */</span>
<a name="l00249"></a>00249         <span class="keywordtype">int</span> grid_width = grid-&gt;<a class="code" href="classGrid.html#a684602f6881a4e9302c0a7e2180a9769">getGridWidth</a>();
<a name="l00250"></a>00250         <span class="keywordtype">int</span> grid_height = grid-&gt;<a class="code" href="classGrid.html#a87b10b08679eb033de8a0e5aa2e57803">getGridHeight</a>();
<a name="l00251"></a>00251         <a class="code" href="classAbstractBlockAligner.html#af70d4b1affa455dd19c21c3661a96341" title="Maintains the minimum gridWidth used.">statMinGridWidth</a>  = std::min(<a class="code" href="classAbstractBlockAligner.html#af70d4b1affa455dd19c21c3661a96341" title="Maintains the minimum gridWidth used.">statMinGridWidth</a> , grid_width);
<a name="l00252"></a>00252         <a class="code" href="classAbstractBlockAligner.html#a9aa697d002211bb7f023a425863a765f" title="Maintains the minimum gridHeight used.">statMinGridHeight</a> = std::min(<a class="code" href="classAbstractBlockAligner.html#a9aa697d002211bb7f023a425863a765f" title="Maintains the minimum gridHeight used.">statMinGridHeight</a>, grid_height);
<a name="l00253"></a>00253         <a class="code" href="classAbstractBlockAligner.html#a2244fa37b9c83610fb601fa10b31531a" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a>  = std::max(<a class="code" href="classAbstractBlockAligner.html#a2244fa37b9c83610fb601fa10b31531a" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a> , grid_width);
<a name="l00254"></a>00254         <a class="code" href="classAbstractBlockAligner.html#a46ca23a99b567c24e17c8925301b9947" title="Maintains the maximum gridHeight used.">statMaxGridHeight</a> = std::max(<a class="code" href="classAbstractBlockAligner.html#a46ca23a99b567c24e17c8925301b9947" title="Maintains the maximum gridHeight used.">statMaxGridHeight</a>, grid_height);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (<a class="code" href="AbstractBlockAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;Configured Grid: B: %d x %d    G: %d x %d\n&quot;</span>, block_width, block_height, grid_width, grid_height);
<a name="l00257"></a>00257         <span class="keywordflow">return</span> <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a>;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="classAbstractBlockAligner.html#ab03e1adc8c835d76d2209db5a7bbcd47">00261</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#ab03e1adc8c835d76d2209db5a7bbcd47" title="This method is called in the beginning of each stage to inform the aligner about the sequence to be a...">AbstractBlockAligner::setSequences</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* seq0, <span class="keyword">const</span> <span class="keywordtype">char</span>* seq1, <span class="keywordtype">int</span> seq0_len, <span class="keywordtype">int</span> seq1_len) {
<a name="l00262"></a>00262         <a class="code" href="classAbstractBlockAligner.html#a16af3780c84a8f5ab08b20d74efce1b3" title="Processor that computes a single block.">blockProcessor</a>-&gt;<a class="code" href="classAbstractBlockProcessor.html#a95d95c008f561ef466b6e269345704be">setSequences</a>(seq0, seq1, seq0_len, seq1_len);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classAbstractBlockAligner.html#af4fdf6d65e029d0d9baa18fd25913141">00265</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#af4fdf6d65e029d0d9baa18fd25913141" title="Defines that the sequence will not be used anymore and the Aligner should deallocate the memory used ...">AbstractBlockAligner::unsetSequences</a>() {
<a name="l00266"></a>00266         <a class="code" href="classAbstractBlockAligner.html#a16af3780c84a8f5ab08b20d74efce1b3" title="Processor that computes a single block.">blockProcessor</a>-&gt;<a class="code" href="classAbstractBlockProcessor.html#ae5ca50629c8224ba30aa574c6ec7d84e">unsetSequences</a>();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 <span class="comment"></span>
<a name="l00269"></a>00269 <span class="comment">/**</span>
<a name="l00270"></a>00270 <span class="comment"> * Aligns the given partition, processing it block by block using a customized</span>
<a name="l00271"></a>00271 <span class="comment"> * scheduler.</span>
<a name="l00272"></a>00272 <span class="comment"> *</span>
<a name="l00273"></a>00273 <span class="comment"> * @param partition partition to be aligned.</span>
<a name="l00274"></a>00274 <span class="comment"> * @see IAligner::alignPartition</span>
<a name="l00275"></a>00275 <span class="comment"> */</span>
<a name="l00276"></a><a class="code" href="classAbstractBlockAligner.html#ae199b0786e3fc62b54d3f5e09161afc1">00276</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#ae199b0786e3fc62b54d3f5e09161afc1" title="Aligns the given partition, processing it block by block using a customized scheduler.">AbstractBlockAligner::alignPartition</a>(<a class="code" href="classPartition.html">Partition</a> partition) {
<a name="l00277"></a>00277         <span class="comment">//fprintf(stderr, &quot;alignPartition()\n&quot;);</span>
<a name="l00278"></a>00278         <span class="comment">//createDispatcherQueue(); // Uncomment this if you want thread-safe calls</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="comment">/* configures the grid */</span>
<a name="l00281"></a>00281         <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a> = <a class="code" href="classAbstractBlockAligner.html#a9651ac81f014c0e79a2ee66bcfdad91a" title="Configures the grid for the given partition.">configureGrid</a>(partition);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="comment">/* the block pruning initialization must be done after grid configuration */</span>
<a name="l00284"></a>00284         <a class="code" href="classAbstractAligner.html#ac731ae81af1b2040bc2324e114df426f" title="Initializes the pruner object.">initializeBlockPruning</a>(<a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a>);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="comment">/* allocates the memory structures. It must be called after grid configuration */</span>
<a name="l00287"></a>00287         <a class="code" href="classAbstractBlockAligner.html#a60d4a28539bc9f7d39cca7bb61829816" title="Allocate vectors after sequence is set.">allocateStructures</a>();
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="comment">/* reads the first top-left cell of the partition. */</span>
<a name="l00290"></a>00290         <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a> dummy;
<a name="l00291"></a>00291         <a class="code" href="classAbstractAligner.html#a5826f966c44d93208b7b8da6763f3eb6" title="Delegates to IManager::receiveFirstColumn()">receiveFirstColumn</a>(&amp;dummy, 1); <span class="comment">// initializes the AbstractAligner::firstColumnTail</span>
<a name="l00292"></a>00292         <a class="code" href="classAbstractAligner.html#a3b0b4d7e643f8d58a8887593070d021d" title="Delegates to IManager::receiveFirstRow()">receiveFirstRow</a>(&amp;dummy, 1); <span class="comment">// initializes the AbstractAligner::firstRowTail</span>
<a name="l00293"></a>00293         <span class="comment">// TODO assert if both tails are equal?</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="comment">/* statistics initializations */</span>
<a name="l00296"></a>00296         <a class="code" href="classAbstractBlockAligner.html#a08ae1b59176af5d5240b344fc9eb42d2" title="Total number of blocks processed in the grid.">statTotalBlocks</a> = 0;
<a name="l00297"></a>00297         <a class="code" href="classAbstractBlockAligner.html#ac8c75cfd79eb84e9974ee2b2e59bf85b" title="Number of pruned blocks.">statPrunedBlocks</a> = 0;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keyword">static</span> <span class="keywordtype">char</span> str[500];
<a name="l00300"></a>00300         sprintf(str, <span class="stringliteral">&quot;profiling.%08d.%08d.%08d.%08d.%d.txt&quot;</span>, partition.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>(), partition.<a class="code" href="classPartition.html#a601c9fbb85bce38451c5272f7271b767">getJ0</a>(), partition.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>(), partition.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>(), <a class="code" href="classAbstractAligner.html#a93948e510ed96e7f0480275cafd423a8" title="Delegates to IManager::mustDispatchLastColumn()">mustDispatchLastColumn</a>());
<a name="l00301"></a>00301         <a class="code" href="AbstractBlockAligner_8cpp.html#a0a1735c10a4e543f3f89532c4ee5b1c4">PROFILING_INIT</a>(str);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">/* local initializations */</span>
<a name="l00304"></a>00304         <span class="keywordtype">int</span> grid_width = grid-&gt;<a class="code" href="classGrid.html#a684602f6881a4e9302c0a7e2180a9769">getGridWidth</a>();
<a name="l00305"></a>00305         <span class="keywordtype">int</span> grid_height = grid-&gt;<a class="code" href="classGrid.html#a87b10b08679eb033de8a0e5aa2e57803">getGridHeight</a>();
<a name="l00306"></a>00306         <a class="code" href="classAbstractBlockAligner.html#aca18f2ed3a882453e557aad29e9d492e" title="Schedules all the blocks for execution.">scheduleBlocks</a>(grid_width, grid_height);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="comment">// TODO o dispatch score deve ser feito on-the-fly durante o estagio 2,</span>
<a name="l00309"></a>00309         <span class="comment">// caso contrario o processamento nao ira parar se encontrarmos o goal score.</span>
<a name="l00310"></a>00310         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bx = 0; bx &lt; grid_width; bx++) {
<a name="l00311"></a>00311                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> by = 0; by &lt; grid_height; by++) {
<a name="l00312"></a>00312                         <span class="comment">/* Dispatch the best score found in block (bx,by) */</span>
<a name="l00313"></a>00313                         <a class="code" href="classAbstractAligner.html#abb033d4cb32f8ab42e2ca5d6bbdf9117" title="Delegates to IManager::dispatchScore()">dispatchScore</a>(<a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[bx][by], bx, by);
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315         }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a6da1710fd04090479af9f24a914c8218" title="Delegates to IManager::mustDispatchLastCell()">mustDispatchLastCell</a>()) {
<a name="l00318"></a>00318                 <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a> score;
<a name="l00319"></a>00319                 score.<a class="code" href="structscore__t.html#aeba6c31e0dbd3e1a7c8716951333624e" title="value of the score">score</a> = <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a>[grid_width-1][grid-&gt;<a class="code" href="classGrid.html#a4201fba476e65ff6a874194de99a9f58">getBlockWidth</a>(grid_width-1, grid_height-1)-1].<a class="code" href="structcell__t.html#a32cac3d952a676d4ebfa39283e1d9f09">h</a>;
<a name="l00320"></a>00320                 score.<a class="code" href="structscore__t.html#a92c1b6f8c1e838fbe605b3826f569811" title="i-coordinate of the score">i</a> = partition.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>()-1;
<a name="l00321"></a>00321                 score.<a class="code" href="structscore__t.html#ab629d8b10c526a3e0d39d6f68e415ccf" title="j-coordinate of the score">j</a> = partition.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>()-1;
<a name="l00322"></a>00322                 <a class="code" href="classAbstractAligner.html#abb033d4cb32f8ab42e2ca5d6bbdf9117" title="Delegates to IManager::dispatchScore()">dispatchScore</a>(score, grid_width-1, grid_height-1);
<a name="l00323"></a>00323         }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325         <a class="code" href="classAbstractBlockAligner.html#a8cafc87a29fa63b85e7cf3c0867ae792" title="Deallocate vectors after sequence is unset.">deallocateStructures</a>();
<a name="l00326"></a>00326         <span class="comment">//destroyDispatcherQueue(); // Uncomment this if you want thread-safe calls</span>
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="comment"></span>
<a name="l00330"></a>00330 <span class="comment">/**</span>
<a name="l00331"></a>00331 <span class="comment"> * This method aligns block (bx,by). This method calls the</span>
<a name="l00332"></a>00332 <span class="comment"> * AbstractBlockAligner::alignBlock(int,int,int,int,int,int)</span>
<a name="l00333"></a>00333 <span class="comment"> * with additional information about block coordinates.</span>
<a name="l00334"></a>00334 <span class="comment"> *</span>
<a name="l00335"></a>00335 <span class="comment"> * @param bx horizontal coordinate of the block in the grid</span>
<a name="l00336"></a>00336 <span class="comment"> * @param by vertical coordinate of the block in the grid</span>
<a name="l00337"></a>00337 <span class="comment"> */</span>
<a name="l00338"></a><a class="code" href="classAbstractBlockAligner.html#a614ee20ab8f3895645ec845381976398">00338</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a2b642900b60f919af1840596869b4fe2" title="This method is called by AbstractBlockAligner::alignBlock(int,int) with additional information about ...">AbstractBlockAligner::alignBlock</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by) {
<a name="l00339"></a>00339         <span class="keywordtype">int</span> i0;
<a name="l00340"></a>00340         <span class="keywordtype">int</span> i1;
<a name="l00341"></a>00341         <span class="keywordtype">int</span> j0;
<a name="l00342"></a>00342         <span class="keywordtype">int</span> j1;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="comment">/* obtains the boundaries of block (bx, by) */</span>
<a name="l00345"></a>00345         <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#add3c701ccfa96da85ebe2922beb8f1bf">getBlockPosition</a>(bx, by, &amp;i0, &amp;j0, &amp;i1, &amp;j1);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <a class="code" href="classAbstractBlockAligner.html#a2b642900b60f919af1840596869b4fe2" title="This method is called by AbstractBlockAligner::alignBlock(int,int) with additional information about ...">alignBlock</a>(bx, by, i0, j0, i1, j1);
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 <span class="comment"></span>
<a name="l00350"></a>00350 <span class="comment">/**</span>
<a name="l00351"></a>00351 <span class="comment"> * This method calls AbstractBlockProcessor::processBlock(int,int,int,int,int,int,int)</span>
<a name="l00352"></a>00352 <span class="comment"> * to execute the recurrence relation for a block.</span>
<a name="l00353"></a>00353 <span class="comment"> *</span>
<a name="l00354"></a>00354 <span class="comment"> * @param bx horizontal block coordinate</span>
<a name="l00355"></a>00355 <span class="comment"> * @param by vertical block coordinate</span>
<a name="l00356"></a>00356 <span class="comment"> * @param i0 vertical first row of the block</span>
<a name="l00357"></a>00357 <span class="comment"> * @param j0 horizontal first column of the block</span>
<a name="l00358"></a>00358 <span class="comment"> * @param i1 vertical last row of the block</span>
<a name="l00359"></a>00359 <span class="comment"> * @param j1 horizontal last column of the block</span>
<a name="l00360"></a>00360 <span class="comment"> * @param true if the block was processed or false if it was pruned.</span>
<a name="l00361"></a>00361 <span class="comment"> */</span>
<a name="l00362"></a><a class="code" href="classAbstractBlockAligner.html#affbd3ae418aa66f5ee2e8746f3df4b30">00362</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractBlockAligner.html#affbd3ae418aa66f5ee2e8746f3df4b30" title="This method calls AbstractBlockProcessor::processBlock(int,int,int,int,int,int,int) to execute the re...">AbstractBlockAligner::processBlock</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by, <span class="keywordtype">int</span> i0, <span class="keywordtype">int</span> j0, <span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> j1) {
<a name="l00363"></a>00363         <span class="keywordflow">if</span> (!<a class="code" href="classAbstractBlockAligner.html#a8dd8c82540a9721c31fea02e79e090c7" title="Check for pruned blocks.">isBlockPruned</a>(bx, by)) {
<a name="l00364"></a>00364                 <span class="comment">/* the block was not pruned */</span>
<a name="l00365"></a>00365                 <span class="keywordflow">if</span> (<a class="code" href="AbstractBlockAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;&gt;&gt;&gt;AbstractBlockAligner::processBlock(%d, %d, %d, %d, %d, %d)\n&quot;</span>, bx, by, i0, j0, i1, j1);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368                 <span class="comment">//if (!mustContinue()) return; // MASA-core is telling to stop</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370                 <a class="code" href="AbstractBlockAligner_8cpp.html#a835e0b611544b36c9d273e9dee8740bd">PROFILING_TIME</a>(t0);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372                 <span class="comment">/* processes the block */</span>
<a name="l00373"></a>00373                 <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[bx][by] = <a class="code" href="classAbstractBlockAligner.html#a16af3780c84a8f5ab08b20d74efce1b3" title="Processor that computes a single block.">blockProcessor</a>-&gt;<a class="code" href="classAbstractBlockProcessor.html#adb29e1e4ac9b345ba1704ffec4415be4">processBlock</a>(<a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a>[bx], <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a>[by], i0, j0, i1, j1, <a class="code" href="classAbstractAligner.html#afacbcb609bbb6d8ebcaafaec73e262af" title="Delegates to IManager::getRecurrenceType()">getRecurrenceType</a>());
<a name="l00374"></a>00374 
<a name="l00375"></a>00375                 <a class="code" href="AbstractBlockAligner_8cpp.html#a835e0b611544b36c9d273e9dee8740bd">PROFILING_TIME</a>(t1);
<a name="l00376"></a>00376                 <a class="code" href="AbstractBlockAligner_8cpp.html#a54f678eae310e54e606a252133ec87e0">PROFILING_PRINT</a>(bx, by, <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[bx][by].score, 1, t1-t0);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378                 <span class="comment">/* Updates the block pruning status */</span>
<a name="l00379"></a>00379                 <a class="code" href="classAbstractBlockAligner.html#abc7c91dbea5d71cdf1bd279bbcf659ee" title="Updates the pruning status accordingly to the block score.">pruningUpdate</a>(bx, by, <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[bx][by].score);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381                 <a class="code" href="classAbstractBlockAligner.html#a076d06c2c178a4bba7f373042cd7993f" title="Increased statistics about block processing.">increaseBlockStat</a>(<span class="keyword">false</span>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383                 <span class="comment">/* Dispatch the best score found in block (bx,by) */</span>
<a name="l00384"></a>00384                 <span class="comment">//dispatchScore(grid_scores[bx][by], bx, by);</span>
<a name="l00385"></a>00385                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00386"></a>00386         } <span class="keywordflow">else</span> {
<a name="l00387"></a>00387                 <span class="comment">/* the block was pruned */</span>
<a name="l00388"></a>00388                 <a class="code" href="classAbstractBlockAligner.html#a81fcfab913261d43f6f984eff71920f6" title="Ignore the computation of a block.">ignoreBlock</a>(bx, by);
<a name="l00389"></a>00389                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 <span class="comment">/*</span>
<a name="l00395"></a>00395 <span class="comment"> * Profiles this block as &quot;pruned&quot;</span>
<a name="l00396"></a>00396 <span class="comment"> */</span>
<a name="l00397"></a><a class="code" href="classAbstractBlockAligner.html#a81fcfab913261d43f6f984eff71920f6">00397</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a81fcfab913261d43f6f984eff71920f6" title="Ignore the computation of a block.">AbstractBlockAligner::ignoreBlock</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by) {
<a name="l00398"></a>00398         <a class="code" href="AbstractBlockAligner_8cpp.html#a54f678eae310e54e606a252133ec87e0">PROFILING_PRINT</a>(bx, by, 0, 0, 0);
<a name="l00399"></a>00399         <a class="code" href="classAbstractBlockAligner.html#a076d06c2c178a4bba7f373042cd7993f" title="Increased statistics about block processing.">increaseBlockStat</a>(<span class="keyword">true</span>);
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">/*</span>
<a name="l00403"></a>00403 <span class="comment"> * Updates statTotalBlocks and statPrunedBlocks variables</span>
<a name="l00404"></a>00404 <span class="comment"> */</span>
<a name="l00405"></a><a class="code" href="classAbstractBlockAligner.html#a076d06c2c178a4bba7f373042cd7993f">00405</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a076d06c2c178a4bba7f373042cd7993f" title="Increased statistics about block processing.">AbstractBlockAligner::increaseBlockStat</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> pruned) {
<a name="l00406"></a>00406         <a class="code" href="classAbstractBlockAligner.html#a08ae1b59176af5d5240b344fc9eb42d2" title="Total number of blocks processed in the grid.">statTotalBlocks</a>++;
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (pruned) {
<a name="l00408"></a>00408                 <a class="code" href="classAbstractBlockAligner.html#ac8c75cfd79eb84e9974ee2b2e59bf85b" title="Number of pruned blocks.">statPrunedBlocks</a>++;
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="comment"></span>
<a name="l00413"></a>00413 <span class="comment">/**</span>
<a name="l00414"></a>00414 <span class="comment"> * Indicates if the blocks on row $by$ must dispatch its last row.</span>
<a name="l00415"></a>00415 <span class="comment"> *</span>
<a name="l00416"></a>00416 <span class="comment"> * @param by the row of blocks.</span>
<a name="l00417"></a>00417 <span class="comment"> * @return true if the last row of the block will be stored (special row).</span>
<a name="l00418"></a>00418 <span class="comment"> */</span>
<a name="l00419"></a><a class="code" href="classAbstractBlockAligner.html#aa0eb7047faa3fbbd9a3c840d58e098bb">00419</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractBlockAligner.html#aa0eb7047faa3fbbd9a3c840d58e098bb" title="Indicates if the blocks on row $by$ must dispatch its last row.">AbstractBlockAligner::isSpecialRow</a>(<span class="keywordtype">int</span> by) {
<a name="l00420"></a>00420         <span class="comment">/*</span>
<a name="l00421"></a>00421 <span class="comment">         * Dispatch special rows with a minimum defined distance (getSpecialRowInterval()).</span>
<a name="l00422"></a>00422 <span class="comment">         */</span>
<a name="l00423"></a>00423         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a583a16cd2ee6415b76b41839dc00be60" title="Delegates to IManager::mustDispatchLastRow()">mustDispatchLastRow</a>() &amp;&amp; by == <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;getGridHeight()-1) {
<a name="l00424"></a>00424                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00425"></a>00425         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#add63e462d1cb771332ff70794af6db64" title="Delegates to IManager::mustDispatchSpecialRows()">mustDispatchSpecialRows</a>()) {
<a name="l00426"></a>00426                 <span class="comment">/*</span>
<a name="l00427"></a>00427 <span class="comment">                 * Note that only the last rows of the blocks are suitable to be a</span>
<a name="l00428"></a>00428 <span class="comment">                 * special row.</span>
<a name="l00429"></a>00429 <span class="comment">                 */</span>
<a name="l00430"></a>00430                 <span class="keyword">const</span> <span class="keywordtype">int</span> block_height = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a369cbe9bb179f13ad37588da6bf764a9">getBlockHeight</a>(0, 0); <span class="comment">// considering that all the blocks has the same height</span>
<a name="l00431"></a>00431                 <span class="keywordtype">int</span> flush_block_interval = (<a class="code" href="classAbstractAligner.html#a1446002ca4fe9bfb0ff89983878b46e3" title="Delegates to IManager::getSpecialRowInterval()">getSpecialRowInterval</a>()+block_height-1)/block_height;
<a name="l00432"></a>00432                 <span class="keywordflow">if</span> (flush_block_interval &lt;= 0) {
<a name="l00433"></a>00433                         flush_block_interval = 1;
<a name="l00434"></a>00434                 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                 <span class="keywordflow">return</span> ((by+1) % flush_block_interval == 0);
<a name="l00437"></a>00437         } <span class="keywordflow">else</span> {
<a name="l00438"></a>00438                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 <span class="comment"></span>
<a name="l00442"></a>00442 <span class="comment">/**</span>
<a name="l00443"></a>00443 <span class="comment"> * Indicates if the blocks on column $bx$ must dispatch its last column.</span>
<a name="l00444"></a>00444 <span class="comment"> *</span>
<a name="l00445"></a>00445 <span class="comment"> * @param bx the column of blocks.</span>
<a name="l00446"></a>00446 <span class="comment"> * @return true if the last column of the block will be stored (special column).</span>
<a name="l00447"></a>00447 <span class="comment"> */</span>
<a name="l00448"></a><a class="code" href="classAbstractBlockAligner.html#a288e98c8beffecff0fee68e7d9d11beb">00448</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractBlockAligner.html#a288e98c8beffecff0fee68e7d9d11beb" title="Indicates if the blocks on column $bx$ must dispatch its last column.">AbstractBlockAligner::isSpecialColumn</a>(<span class="keywordtype">int</span> bx) {
<a name="l00449"></a>00449         <span class="keywordflow">return</span> (<a class="code" href="classAbstractAligner.html#a93948e510ed96e7f0480275cafd423a8" title="Delegates to IManager::mustDispatchLastColumn()">mustDispatchLastColumn</a>() &amp;&amp; bx == <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;getGridWidth()-1);
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 <span class="comment"></span>
<a name="l00452"></a>00452 <span class="comment">/**</span>
<a name="l00453"></a>00453 <span class="comment"> * Prints the pruning statistics and grid used range.</span>
<a name="l00454"></a>00454 <span class="comment"> * @param file handler to print out the statistics.</span>
<a name="l00455"></a>00455 <span class="comment"> * @see IAligner::printStatistics</span>
<a name="l00456"></a>00456 <span class="comment"> */</span>
<a name="l00457"></a><a class="code" href="classAbstractBlockAligner.html#ae1dcf60f662469ff1993742578272a71">00457</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#ae1dcf60f662469ff1993742578272a71" title="Prints the pruning statistics and grid used range.">AbstractBlockAligner::printStatistics</a>(FILE* file) {
<a name="l00458"></a>00458         <span class="comment">// Print final statistics to the statistics file;</span>
<a name="l00459"></a>00459         fprintf(file, <span class="stringliteral">&quot;\n=====  PRUNING STATS   =====\n&quot;</span>);
<a name="l00460"></a>00460         fprintf(file, <span class="stringliteral">&quot;Pruned Blocks: %d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#ac8c75cfd79eb84e9974ee2b2e59bf85b" title="Number of pruned blocks.">statPrunedBlocks</a>);
<a name="l00461"></a>00461         fprintf(file, <span class="stringliteral">&quot;Pruned Blocks: %.4f%%\n&quot;</span>,
<a name="l00462"></a>00462                         (<a class="code" href="classAbstractBlockAligner.html#ac8c75cfd79eb84e9974ee2b2e59bf85b" title="Number of pruned blocks.">statPrunedBlocks</a> * 100.0f) / <a class="code" href="classAbstractBlockAligner.html#a08ae1b59176af5d5240b344fc9eb42d2" title="Total number of blocks processed in the grid.">statTotalBlocks</a>);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464         fprintf(file, <span class="stringliteral">&quot;\n===== RUNTIME VARIABLES =====\n&quot;</span>);
<a name="l00465"></a>00465         fprintf(file, <span class="stringliteral">&quot;      Block Width: %d-%d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#af6dbf5905ab9a1db30a067f5d8c3e931" title="Maintains the minimum blockWidth used.">statMinBlockWidth</a>, <a class="code" href="classAbstractBlockAligner.html#a5cdcb31f77690cfdda1111f9833095bd" title="Maintains the maximum blockWidth used.">statMaxBlockWidth</a>);
<a name="l00466"></a>00466         fprintf(file, <span class="stringliteral">&quot;     Block Height: %d-%d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#a7b4528410736bbdf703232554845031e" title="Maintains the minimum blockHeight used.">statMinBlockHeight</a>, <a class="code" href="classAbstractBlockAligner.html#a271ac9f80e82e5487c59c57a8abb4cbb" title="Maintains the maximum blockHeight used.">statMaxBlockHeight</a>);
<a name="l00467"></a>00467         fprintf(file, <span class="stringliteral">&quot;       Grid Width: %d-%d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#af70d4b1affa455dd19c21c3661a96341" title="Maintains the minimum gridWidth used.">statMinGridWidth</a>, <a class="code" href="classAbstractBlockAligner.html#a2244fa37b9c83610fb601fa10b31531a" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a>);
<a name="l00468"></a>00468         fprintf(file, <span class="stringliteral">&quot;      Grid Height: %d-%d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#a9aa697d002211bb7f023a425863a765f" title="Maintains the minimum gridHeight used.">statMinGridHeight</a>, <a class="code" href="classAbstractBlockAligner.html#a46ca23a99b567c24e17c8925301b9947" title="Maintains the maximum gridHeight used.">statMaxGridHeight</a>);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         fflush(file);
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 <span class="comment"></span>
<a name="l00473"></a>00473 <span class="comment">/**</span>
<a name="l00474"></a>00474 <span class="comment"> * Prints the runtime parameters.</span>
<a name="l00475"></a>00475 <span class="comment"> * @param file handler to print out the statistics.</span>
<a name="l00476"></a>00476 <span class="comment"> * @see IAligner::printInitialStatistics</span>
<a name="l00477"></a>00477 <span class="comment"> */</span>
<a name="l00478"></a><a class="code" href="classAbstractBlockAligner.html#a445cc1057a26d2b1d47b638caf08915d">00478</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a445cc1057a26d2b1d47b638caf08915d" title="Prints the runtime parameters.">AbstractBlockAligner::printInitialStatistics</a>(FILE* file) {
<a name="l00479"></a>00479         fprintf(file, <span class="stringliteral">&quot;\n===== RUNTIME PARAMETERS =====\n&quot;</span>);
<a name="l00480"></a>00480         fprintf(file, <span class="stringliteral">&quot; %s height: %d\n&quot;</span>,
<a name="l00481"></a>00481                         <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#ab3431f0d2b3f9ab7628dcf651864cc3d">getBlockHeight</a>() ? <span class="stringliteral">&quot;Block&quot;</span> : <span class="stringliteral">&quot;Grid&quot;</span>,
<a name="l00482"></a>00482                         <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#ab3431f0d2b3f9ab7628dcf651864cc3d">getBlockHeight</a>() ? <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#ab3431f0d2b3f9ab7628dcf651864cc3d">getBlockHeight</a>() : <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a2681770d130f33791f4d2f7540c87c7f">getGridHeight</a>());
<a name="l00483"></a>00483         fprintf(file, <span class="stringliteral">&quot; %s width: %d\n&quot;</span>,
<a name="l00484"></a>00484                         <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a60a4f5c86983606178949979fbe596b0">getBlockWidth</a>() ? <span class="stringliteral">&quot;Block&quot;</span> : <span class="stringliteral">&quot;Grid&quot;</span>,
<a name="l00485"></a>00485                         <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a60a4f5c86983606178949979fbe596b0">getBlockWidth</a>() ? <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#a60a4f5c86983606178949979fbe596b0">getBlockWidth</a>() : <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classBlockAlignerParameters.html#aabdda3d80a7aacb811bc3501f854212d">getGridWidth</a>());
<a name="l00486"></a>00486         fprintf(file, <span class="stringliteral">&quot; ForkID: %d\n&quot;</span>, <a class="code" href="classAbstractBlockAligner.html#ad121576cc541cde49cccd25080e1deec" title="Parameter used in this aligner.">params</a>-&gt;<a class="code" href="classAbstractAlignerParameters.html#a7eba0287ad990ab2767b71ea6868f548" title="Returns the Id of the forked process.">getForkId</a>());
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 <span class="comment"></span>
<a name="l00489"></a>00489 <span class="comment">/**</span>
<a name="l00490"></a>00490 <span class="comment"> * @copydoc IAligner::clearStatistics</span>
<a name="l00491"></a>00491 <span class="comment"> */</span>
<a name="l00492"></a><a class="code" href="classAbstractBlockAligner.html#a695f5fc098064c47055cac7ad5f5e734">00492</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a695f5fc098064c47055cac7ad5f5e734">AbstractBlockAligner::clearStatistics</a>() {
<a name="l00493"></a>00493         <a class="code" href="classAbstractBlockAligner.html#a08ae1b59176af5d5240b344fc9eb42d2" title="Total number of blocks processed in the grid.">statTotalBlocks</a> = 0;
<a name="l00494"></a>00494         <a class="code" href="classAbstractBlockAligner.html#ac8c75cfd79eb84e9974ee2b2e59bf85b" title="Number of pruned blocks.">statPrunedBlocks</a> = 0;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <a class="code" href="classAbstractBlockAligner.html#af6dbf5905ab9a1db30a067f5d8c3e931" title="Maintains the minimum blockWidth used.">statMinBlockWidth</a> = <a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00497"></a>00497         <a class="code" href="classAbstractBlockAligner.html#a5cdcb31f77690cfdda1111f9833095bd" title="Maintains the maximum blockWidth used.">statMaxBlockWidth</a> = 0;
<a name="l00498"></a>00498         <a class="code" href="classAbstractBlockAligner.html#a7b4528410736bbdf703232554845031e" title="Maintains the minimum blockHeight used.">statMinBlockHeight</a> = <a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00499"></a>00499         <a class="code" href="classAbstractBlockAligner.html#a271ac9f80e82e5487c59c57a8abb4cbb" title="Maintains the maximum blockHeight used.">statMaxBlockHeight</a> = 0;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <a class="code" href="classAbstractBlockAligner.html#af70d4b1affa455dd19c21c3661a96341" title="Maintains the minimum gridWidth used.">statMinGridWidth</a> = <a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00502"></a>00502         <a class="code" href="classAbstractBlockAligner.html#a2244fa37b9c83610fb601fa10b31531a" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a> = 0;
<a name="l00503"></a>00503         <a class="code" href="classAbstractBlockAligner.html#a9aa697d002211bb7f023a425863a765f" title="Maintains the minimum gridHeight used.">statMinGridHeight</a> = <a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00504"></a>00504         <a class="code" href="classAbstractBlockAligner.html#a46ca23a99b567c24e17c8925301b9947" title="Maintains the maximum gridHeight used.">statMaxGridHeight</a> = 0;
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 <span class="comment"></span>
<a name="l00507"></a>00507 <span class="comment">/** Empty stub for the superclass virtual method.</span>
<a name="l00508"></a>00508 <span class="comment"> * @copydoc IAligner::printStageStatistics</span>
<a name="l00509"></a>00509 <span class="comment"> */</span>
<a name="l00510"></a><a class="code" href="classAbstractBlockAligner.html#ae31fe0c34a64a211836842a81b5f70c5">00510</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#ae31fe0c34a64a211836842a81b5f70c5" title="Empty stub for the superclass virtual method.">AbstractBlockAligner::printStageStatistics</a>(FILE* file) {
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 <span class="comment"></span>
<a name="l00513"></a>00513 <span class="comment">/** Empty stub for the superclass virtual method.</span>
<a name="l00514"></a>00514 <span class="comment"> * @copydoc IAligner::printFinalStatistics</span>
<a name="l00515"></a>00515 <span class="comment"> */</span>
<a name="l00516"></a><a class="code" href="classAbstractBlockAligner.html#a17ff889346867a57536bc907f7d9d224">00516</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a17ff889346867a57536bc907f7d9d224" title="Empty stub for the superclass virtual method.">AbstractBlockAligner::printFinalStatistics</a>(FILE* file) {
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">/*</span>
<a name="l00520"></a>00520 <span class="comment"> * This method returns a progress string that is printed periodically.</span>
<a name="l00521"></a>00521 <span class="comment"> */</span>
<a name="l00522"></a><a class="code" href="classAbstractBlockAligner.html#a3fc8553551cb911ae9e667ace1f68e64">00522</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAbstractBlockAligner.html#a3fc8553551cb911ae9e667ace1f68e64" title="Returns a string that will be appended into some intermediate statistics information of stage 1...">AbstractBlockAligner::getProgressString</a>()<span class="keyword"> const </span>{
<a name="l00523"></a>00523         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">/*</span>
<a name="l00527"></a>00527 <span class="comment"> *</span>
<a name="l00528"></a>00528 <span class="comment"> */</span>
<a name="l00529"></a><a class="code" href="classAbstractBlockAligner.html#a1fa237f3ca5082c6cb11b70ce363ade5">00529</a> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classAbstractBlockAligner.html#a1fa237f3ca5082c6cb11b70ce363ade5" title="Returns the number of cells that have been processed since the last call to clearStatistics.">AbstractBlockAligner::getProcessedCells</a>() {
<a name="l00530"></a>00530         <span class="keywordflow">return</span> 0; <span class="comment">// Used to calculate the MCUPS performance metric</span>
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 <span class="comment"></span>
<a name="l00533"></a>00533 <span class="comment">/**</span>
<a name="l00534"></a>00534 <span class="comment"> * Allocate vectors after sequence is set.</span>
<a name="l00535"></a>00535 <span class="comment"> */</span>
<a name="l00536"></a><a class="code" href="classAbstractBlockAligner.html#a60d4a28539bc9f7d39cca7bb61829816">00536</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a60d4a28539bc9f7d39cca7bb61829816" title="Allocate vectors after sequence is set.">AbstractBlockAligner::allocateStructures</a>() {
<a name="l00537"></a>00537         <span class="comment">/*</span>
<a name="l00538"></a>00538 <span class="comment">         * Allocates the first row of each block. This vector is transferred</span>
<a name="l00539"></a>00539 <span class="comment">         * from on block to the other, in the vertical direction.</span>
<a name="l00540"></a>00540 <span class="comment">         */</span>
<a name="l00541"></a>00541         <span class="keywordtype">int</span> grid_width = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a684602f6881a4e9302c0a7e2180a9769">getGridWidth</a>();
<a name="l00542"></a>00542         <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a> = <span class="keyword">new</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*[grid_width];
<a name="l00543"></a>00543         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;grid_width; j++) {
<a name="l00544"></a>00544                 <span class="keywordtype">int</span> block_width = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a4201fba476e65ff6a874194de99a9f58">getBlockWidth</a>(j,0);
<a name="l00545"></a>00545                 <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a>[j] = <span class="keyword">new</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>[block_width];
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548         <span class="comment">/*</span>
<a name="l00549"></a>00549 <span class="comment">         * Allocates the first column of each block. This vector is transferred</span>
<a name="l00550"></a>00550 <span class="comment">         * from on block to the other, in the horizontal direction.</span>
<a name="l00551"></a>00551 <span class="comment">         */</span>
<a name="l00552"></a>00552         <span class="keywordtype">int</span> grid_height = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a87b10b08679eb033de8a0e5aa2e57803">getGridHeight</a>();
<a name="l00553"></a>00553         <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a> = <span class="keyword">new</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*[grid_height];
<a name="l00554"></a>00554         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;grid_height; i++) {
<a name="l00555"></a>00555                 <span class="keywordtype">int</span> block_height = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a369cbe9bb179f13ad37588da6bf764a9">getBlockHeight</a>(0,i);
<a name="l00556"></a>00556                 <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a>[i] = <span class="keyword">new</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>[block_height+1];
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a> = <span class="keyword">new</span> <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a>*[ grid_width ];
<a name="l00562"></a>00562         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; grid_width; ++j ){
<a name="l00563"></a>00563                 <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[j] = <span class="keyword">new</span> <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a>[ grid_height ];
<a name="l00564"></a>00564                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; grid_height; ++i ) {
<a name="l00565"></a>00565                         <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[j][i].<a class="code" href="structscore__t.html#aeba6c31e0dbd3e1a7c8716951333624e" title="value of the score">score</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00566"></a>00566                 }
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 <span class="comment"></span>
<a name="l00570"></a>00570 <span class="comment">/**</span>
<a name="l00571"></a>00571 <span class="comment"> * Deallocate vectors after sequence is unset.</span>
<a name="l00572"></a>00572 <span class="comment"> */</span>
<a name="l00573"></a><a class="code" href="classAbstractBlockAligner.html#a8cafc87a29fa63b85e7cf3c0867ae792">00573</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#a8cafc87a29fa63b85e7cf3c0867ae792" title="Deallocate vectors after sequence is unset.">AbstractBlockAligner::deallocateStructures</a>() {
<a name="l00574"></a>00574         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>() == NULL) {
<a name="l00575"></a>00575                 <span class="keywordflow">return</span>;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         <span class="keywordtype">int</span> grid_width = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a684602f6881a4e9302c0a7e2180a9769">getGridWidth</a>();
<a name="l00578"></a>00578         <span class="keywordtype">int</span> grid_height = <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#a87b10b08679eb033de8a0e5aa2e57803">getGridHeight</a>();
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a> != NULL) {
<a name="l00581"></a>00581                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; grid_width; ++j) {
<a name="l00582"></a>00582                         <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a>[j];
<a name="l00583"></a>00583                 }
<a name="l00584"></a>00584                 <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a>;
<a name="l00585"></a>00585                 <a class="code" href="classAbstractBlockAligner.html#a8ac604122d2a546bd8f4322061e14a60" title="Chunk of rows used to pass cells from up to bottom blocks.">row</a> = NULL;
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a> != NULL) {
<a name="l00588"></a>00588                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; grid_height; ++i) {
<a name="l00589"></a>00589                         <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a>[i];
<a name="l00590"></a>00590                 }
<a name="l00591"></a>00591                 <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a>;
<a name="l00592"></a>00592                 <a class="code" href="classAbstractBlockAligner.html#acac4c17ee9612b452492a3e58dc09dce" title="Chunk of columns used to pass cells from left to right blocks.">col</a> = NULL;
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594         <span class="keywordflow">if</span>(<a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a> != NULL) {
<a name="l00595"></a>00595                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; grid_width; ++j ){
<a name="l00596"></a>00596                         <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>[j];
<a name="l00597"></a>00597                 }
<a name="l00598"></a>00598                 <span class="keyword">delete</span>[] <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a>;
<a name="l00599"></a>00599                 <a class="code" href="classAbstractBlockAligner.html#a948ecb3eaa3aa81e03100e8659115da4" title="Stores the score of each grid.">grid_scores</a> = NULL;
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 <span class="comment"></span>
<a name="l00603"></a>00603 <span class="comment">/**</span>
<a name="l00604"></a>00604 <span class="comment"> * Returns true if block (bx, by) can be pruned.</span>
<a name="l00605"></a>00605 <span class="comment"> *</span>
<a name="l00606"></a>00606 <span class="comment"> * @param bx horizontal block coordinate</span>
<a name="l00607"></a>00607 <span class="comment"> * @param by vertical block coordinate</span>
<a name="l00608"></a>00608 <span class="comment"> * @return pruned status of the block.</span>
<a name="l00609"></a>00609 <span class="comment"> */</span>
<a name="l00610"></a><a class="code" href="classAbstractBlockAligner.html#a8dd8c82540a9721c31fea02e79e090c7">00610</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractBlockAligner.html#a8dd8c82540a9721c31fea02e79e090c7" title="Check for pruned blocks.">AbstractBlockAligner::isBlockPruned</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by)<span class="keyword"> const </span>{
<a name="l00611"></a>00611         <span class="keywordflow">return</span> (<a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a> != NULL &amp;&amp; <a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a>-&gt;<a class="code" href="classBlockPruningGenericN2.html#a46af31018d5cde0b09e9c7699c4adba2">isBlockPruned</a>(bx, by));
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 <span class="comment"></span>
<a name="l00614"></a>00614 <span class="comment">/**</span>
<a name="l00615"></a>00615 <span class="comment"> * Updates the pruning status accordingly to the block score.</span>
<a name="l00616"></a>00616 <span class="comment"> *</span>
<a name="l00617"></a>00617 <span class="comment"> * @param bx horizontal block coordinate</span>
<a name="l00618"></a>00618 <span class="comment"> * @param by vertical block coordinate</span>
<a name="l00619"></a>00619 <span class="comment"> * @param score the score of block at coordinate $(bx,by)$</span>
<a name="l00620"></a>00620 <span class="comment"> */</span>
<a name="l00621"></a><a class="code" href="classAbstractBlockAligner.html#abc7c91dbea5d71cdf1bd279bbcf659ee">00621</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#abc7c91dbea5d71cdf1bd279bbcf659ee" title="Updates the pruning status accordingly to the block score.">AbstractBlockAligner::pruningUpdate</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by, <span class="keywordtype">int</span> score) {
<a name="l00622"></a>00622         <span class="keywordflow">if</span> (<a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a> != NULL) {
<a name="l00623"></a>00623                 <a class="code" href="classAbstractBlockAligner.html#ab74f277ac6716cd8070faf2083753079" title="Block Pruner object.">blockPruner</a>-&gt;<a class="code" href="classBlockPruningGenericN2.html#aa0acf957fee405454118248b51fdb6bd">pruningUpdate</a>(bx, by, score);
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 <span class="comment"></span>
<a name="l00627"></a>00627 <span class="comment">/**</span>
<a name="l00628"></a>00628 <span class="comment"> * Defines the preferred block/grid sizes. Used as a hint.</span>
<a name="l00629"></a>00629 <span class="comment"> *</span>
<a name="l00630"></a>00630 <span class="comment"> * @param preferredBlockSize the preferred maximum size of a block.</span>
<a name="l00631"></a>00631 <span class="comment"> * @param preferredGridSize the preferred minimum grid size.</span>
<a name="l00632"></a>00632 <span class="comment"> */</span>
<a name="l00633"></a><a class="code" href="classAbstractBlockAligner.html#aac0e1f11b4ab6e615cc8e2a5dd2cec26">00633</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractBlockAligner.html#aac0e1f11b4ab6e615cc8e2a5dd2cec26" title="Defines the preferred size of a block and the preferred number of blocks in the grid.">AbstractBlockAligner::setPreferredSizes</a>(<span class="keywordtype">int</span> preferredBlockSize,    <span class="keywordtype">int</span> preferredGridSize) {
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (preferredBlockSize &gt; 0) {
<a name="l00635"></a>00635                 this-&gt;preferredBlockSize = <a class="code" href="classAbstractBlockAligner.html#a0619b27f6a298192d1b6cd193299b351" title="Preferred maximum size of a block.">preferredBlockSize</a>;
<a name="l00636"></a>00636         }
<a name="l00637"></a>00637         <span class="keywordflow">if</span> (preferredGridSize &gt; 0) {
<a name="l00638"></a>00638                 this-&gt;preferredGridSize = <a class="code" href="classAbstractBlockAligner.html#a58ce0521a7be29121ac5662fe355599e" title="Preferred minimum grid size.">preferredGridSize</a>;
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri May 8 2015 11:39:19 for MASA-Core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
