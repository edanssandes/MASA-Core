<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MASA-Core: AbstractDiagonalAligner.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MASA-Core
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">AbstractDiagonalAligner.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AbstractDiagonalAligner_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (c) 2010-2015   Edans Sandes</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of MASA-Core.</span>
<a name="l00006"></a>00006 <span class="comment"> * </span>
<a name="l00007"></a>00007 <span class="comment"> * MASA-Core is free software: you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment"> * (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"> * </span>
<a name="l00012"></a>00012 <span class="comment"> * MASA-Core is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"> * </span>
<a name="l00017"></a>00017 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment"> * along with MASA-Core.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> ******************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="AbstractDiagonalAligner_8hpp.html">AbstractDiagonalAligner.hpp</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">/**</span>
<a name="l00027"></a>00027 <span class="comment"> * Set to (1) in order to print debug information in the stdout. This</span>
<a name="l00028"></a>00028 <span class="comment"> * significantly degrades the performance.</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a><a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">00030</a> <span class="preprocessor">#define DEBUG (0)</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">/**</span>
<a name="l00033"></a>00033 <span class="comment"> * Defines a lower-bound flush interval between two special rows.</span>
<a name="l00034"></a>00034 <span class="comment"> */</span>
<a name="l00035"></a><a class="code" href="AbstractDiagonalAligner_8cpp.html#a5fd5a7f32ea0cbbdb19f5c783bda48ad">00035</a> <span class="preprocessor">#define MINIMUM_FLUSH_INTERVAL  (8*1024)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">/**</span>
<a name="l00038"></a>00038 <span class="comment"> * AbstractDiagonalAligner constructor.</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a><a class="code" href="classAbstractDiagonalAligner.html#a9632d0d7458565990e1b14460c3e88ee">00040</a> <a class="code" href="classAbstractDiagonalAligner.html#a9632d0d7458565990e1b14460c3e88ee" title="AbstractDiagonalAligner constructor.">AbstractDiagonalAligner::AbstractDiagonalAligner</a>() {
<a name="l00041"></a>00041         <a class="code" href="classAbstractDiagonalAligner.html#af7e78bd7886fcfa086198a03131875ee" title="Block Pruner object.">pruner</a> = <span class="keyword">new</span> <a class="code" href="classBlockPruningDiagonal.html">BlockPruningDiagonal</a>();
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 <span class="comment"></span>
<a name="l00045"></a>00045 <span class="comment">/**</span>
<a name="l00046"></a>00046 <span class="comment"> * AbstractDiagonalAligner destructor.</span>
<a name="l00047"></a>00047 <span class="comment"> */</span>
<a name="l00048"></a><a class="code" href="classAbstractDiagonalAligner.html#ad3c3fd8665d90af529d079ab17341a39">00048</a> <a class="code" href="classAbstractDiagonalAligner.html#ad3c3fd8665d90af529d079ab17341a39" title="AbstractDiagonalAligner destructor.">AbstractDiagonalAligner::~AbstractDiagonalAligner</a>() {
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">/**</span>
<a name="l00054"></a>00054 <span class="comment"> * Aligns the given partition, processing it by antidiagonals.</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> * @param partition partition to be aligned.</span>
<a name="l00057"></a>00057 <span class="comment"> * @see IAligner::alignPartition</span>
<a name="l00058"></a>00058 <span class="comment"> */</span>
<a name="l00059"></a><a class="code" href="classAbstractDiagonalAligner.html#ac866014418d209fbe341fc77997f8be5">00059</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#ac866014418d209fbe341fc77997f8be5" title="Aligns the given partition, processing it by antidiagonals.">AbstractDiagonalAligner::alignPartition</a>(<a class="code" href="classPartition.html">Partition</a> partition) {
<a name="l00060"></a>00060         this-&gt;partition = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <span class="comment">//createDispatcherQueue();</span>
<a name="l00063"></a>00063         <a class="code" href="classAbstractDiagonalAligner.html#a698feb77174bad8b8d5da8d1c9b321e1" title="Configures the grid and initializes other structures before the beginning of the diagonal iterations...">prepareIterations</a>();
<a name="l00064"></a>00064         <span class="keywordflow">while</span> (<a class="code" href="classAbstractDiagonalAligner.html#a11e5e90e0e4acb796f4da06e96492d85" title="Tests if we have more diagonals to be processed.">hasMoreIterations</a>() &amp;&amp; <a class="code" href="classAbstractAligner.html#ac00d50ea3dcb969c622c8fe2d6ac0160" title="Delegates to IManager::mustContinue()">mustContinue</a>()) {
<a name="l00065"></a>00065                 <a class="code" href="classAbstractDiagonalAligner.html#a55f6bb67c82275d6d48d1ba312a4b41d" title="Processes the next diagonal and loads/flushes the rows and columns necessary for the MASA-Core integr...">processNextIteration</a>();
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <a class="code" href="classAbstractDiagonalAligner.html#a6de98b3db936af952ada05aacab80c43" title="Finalizes the execution of the partition.">finalizeIterations</a>();
<a name="l00068"></a>00068         <span class="keywordflow">if</span> (<a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;End of alignPartition: %d %d\n&quot;</span>, <a class="code" href="classAbstractDiagonalAligner.html#a11e5e90e0e4acb796f4da06e96492d85" title="Tests if we have more diagonals to be processed.">hasMoreIterations</a>(), <a class="code" href="classAbstractAligner.html#ac00d50ea3dcb969c622c8fe2d6ac0160" title="Delegates to IManager::mustContinue()">mustContinue</a>());
<a name="l00069"></a>00069         <span class="comment">//destroyDispatcherQueue();</span>
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 <span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">/**</span>
<a name="l00073"></a>00073 <span class="comment"> * Configures the grid and initializes other structures before the beginning of</span>
<a name="l00074"></a>00074 <span class="comment"> * the diagonal iterations.</span>
<a name="l00075"></a>00075 <span class="comment"> */</span>
<a name="l00076"></a><a class="code" href="classAbstractDiagonalAligner.html#a698feb77174bad8b8d5da8d1c9b321e1">00076</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a698feb77174bad8b8d5da8d1c9b321e1" title="Configures the grid and initializes other structures before the beginning of the diagonal iterations...">AbstractDiagonalAligner::prepareIterations</a>() {
<a name="l00077"></a>00077         <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a> = <a class="code" href="classAbstractDiagonalAligner.html#adc8e86cf8aa1f1064f473b2930165495" title="Configures the grid for the given partition.">configureGrid</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <a class="code" href="classAbstractAligner.html#ac731ae81af1b2040bc2324e114df426f" title="Initializes the pruner object.">initializeBlockPruning</a>(<a class="code" href="classAbstractDiagonalAligner.html#af7e78bd7886fcfa086198a03131875ee" title="Block Pruner object.">pruner</a>);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a> = (<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*)malloc((<a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>()+1)*<span class="keyword">sizeof</span>(<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>));
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="comment">/* reads the first top-left cell of the partition. */</span>
<a name="l00084"></a>00084         <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a> dummy;
<a name="l00085"></a>00085         <a class="code" href="classAbstractAligner.html#a5826f966c44d93208b7b8da6763f3eb6" title="Delegates to IManager::receiveFirstColumn()">receiveFirstColumn</a>(&amp;dummy, 1); <span class="comment">// initializes the AbstractAligner::firstColumnTail</span>
<a name="l00086"></a>00086         <a class="code" href="classAbstractAligner.html#a3b0b4d7e643f8d58a8887593070d021d" title="Delegates to IManager::receiveFirstRow()">receiveFirstRow</a>(&amp;dummy, 1); <span class="comment">// initializes the AbstractAligner::firstRowTail</span>
<a name="l00087"></a>00087         <span class="comment">// TODO assert if both tails are equal?</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <a class="code" href="classAbstractDiagonalAligner.html#a7a4a0e27d3ba4da77ccef3a471303644" title="Initialize the first row of the aligner with the cells received from the MASA-Core.">loadFirstRow</a>();
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> = 0;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         grid-&gt;<a class="code" href="classGrid.html#a87b10b08679eb033de8a0e5aa2e57803">getGridHeight</a>();
<a name="l00095"></a>00095         <a class="code" href="classAbstractDiagonalAligner.html#ab5a4092447af68aa2f1b27cf85157f23" title="number of rows of blocks">gridHeight</a> = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>()/<a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>() + 1;
<a name="l00096"></a>00096     <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a> = <a class="code" href="classAbstractDiagonalAligner.html#ab5a4092447af68aa2f1b27cf85157f23" title="number of rows of blocks">gridHeight</a> + <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>;
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (<a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;Grid height: %d    Blocks: %d    %d-%d:%d\n&quot;</span>, <a class="code" href="classAbstractDiagonalAligner.html#ab5a4092447af68aa2f1b27cf85157f23" title="number of rows of blocks">gridHeight</a>, gridWidth, <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>(), <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>(), <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>());
<a name="l00098"></a>00098     <span class="keywordflow">if</span> (<a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;START: %d steps\n&quot;</span>, <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         <a class="code" href="classAbstractDiagonalAligner.html#abfa3086a693e28c09d371ffaf5b34af7" title="First block of non-pruned window.">windowStart</a> = 0;
<a name="l00101"></a>00101         <a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a> = <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <a class="code" href="classAbstractDiagonalAligner.html#a1fead349016a3e2fa9e172cc6bf34e1f" title="Executes initialization procedures before the first diagonal be processed.">initializeDiagonals</a>(); <span class="comment">// calls subclass</span>
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">/**</span>
<a name="l00107"></a>00107 <span class="comment"> * Processes the next diagonal and loads/flushes the rows and columns necessary</span>
<a name="l00108"></a>00108 <span class="comment"> * for the MASA-Core integration.</span>
<a name="l00109"></a>00109 <span class="comment"> */</span>
<a name="l00110"></a><a class="code" href="classAbstractDiagonalAligner.html#a55f6bb67c82275d6d48d1ba312a4b41d">00110</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a55f6bb67c82275d6d48d1ba312a4b41d" title="Processes the next diagonal and loads/flushes the rows and columns necessary for the MASA-Core integr...">AbstractDiagonalAligner::processNextIteration</a>() {
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <span class="comment">/* Implemented capability: aligner_capabilities_t::customize_first_column */</span>
<a name="l00113"></a>00113         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a4af4756383624780721d22c831e6bca9" title="Delegates to IManager::getFirstColumnInitType()">getFirstColumnInitType</a>() != <a class="code" href="IManager_8hpp.html#a8f9f2282b41c090a5b87c37d72847d85" title="Init row/column with zeros.">INIT_WITH_ZEROES</a>) {
<a name="l00114"></a>00114                 <a class="code" href="classAbstractDiagonalAligner.html#afb626662cdbce5f854800e9c8cf9ffc4" title="Initialize the first column of the aligner with the cells received from the MASA-Core.">loadFirstColumn</a>();
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <a class="code" href="classAbstractDiagonalAligner.html#abe7ade7700d047727540167703e49e88" title="Executes one diagonal with the blocks from $[windowLeft, windowRight]$.">processDiagonal</a>(<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>, <a class="code" href="classAbstractDiagonalAligner.html#abfa3086a693e28c09d371ffaf5b34af7" title="First block of non-pruned window.">windowStart</a>, <a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="comment">/* Implemented aligner_capabilities_t::dispatch_special_row */</span>
<a name="l00120"></a>00120         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#add63e462d1cb771332ff70794af6db64" title="Delegates to IManager::mustDispatchSpecialRows()">mustDispatchSpecialRows</a>()) {
<a name="l00121"></a>00121                 <a class="code" href="classAbstractDiagonalAligner.html#ab806746910e21bd01702477bb0b1995e" title="Iterates on the blocks and check if any of them must flush its last row in the disk.">flushSpecialRows</a>();
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123         <span class="comment">/* Implemented aligner_capabilities_t::dispatch_last_row */</span>
<a name="l00124"></a>00124         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a583a16cd2ee6415b76b41839dc00be60" title="Delegates to IManager::mustDispatchLastRow()">mustDispatchLastRow</a>()) {
<a name="l00125"></a>00125                 <a class="code" href="classAbstractDiagonalAligner.html#a215586a2aa9fc0deca2d9c9abef82cbb" title="This function reads a chunk of the last row from the aligner and dispatch it to the MASA-Core...">flushLastRow</a>();
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127         <span class="comment">/* Implemented aligner_capabilities_t::dispatch_last_rcolumn */</span>
<a name="l00128"></a>00128         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a93948e510ed96e7f0480275cafd423a8" title="Delegates to IManager::mustDispatchLastColumn()">mustDispatchLastColumn</a>()) {
<a name="l00129"></a>00129                 <a class="code" href="classAbstractDiagonalAligner.html#a2fa88132695eb2768f0d280f2dcbcc57" title="This function reads a chunk of the last column from the aligner and dispatch it to the MASA-Core...">flushLastColumn</a>();
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131         <span class="comment">/* Implemented aligner_capabilities_t::dispatch_scores */</span>
<a name="l00132"></a>00132         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a568cdc885f97ee5e6f5f219300c71e65" title="Delegates to IManager::mustDispatchScores()">mustDispatchScores</a>()) {
<a name="l00133"></a>00133                 <a class="code" href="classAbstractDiagonalAligner.html#ad23c6cf321dd2498d69e225e16fd9fc3" title="This function reads the block scores from aligner and dispatch them to the MASA-Core.">flushBlockScores</a>();
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135         <span class="comment">/* Implemented aligner_capabilities_t::block_pruning */</span>
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#ac2ca4fbe023f36985d5bfcc5c9a8cd93" title="Delegates to IManager::mustPruneBlocks()">mustPruneBlocks</a>()) {
<a name="l00137"></a>00137                 <a class="code" href="classAbstractDiagonalAligner.html#ae4a7f35bf376916a0668c0ecbbd9778b" title="Updates the pruning window accordingly to the last block scores.">pruneBlocks</a>();
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="comment">/* Implemented aligner_capabilities_t::dispatch_last_cell */</span>
<a name="l00140"></a>00140         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a6da1710fd04090479af9f24a914c8218" title="Delegates to IManager::mustDispatchLastCell()">mustDispatchLastCell</a>()) {
<a name="l00141"></a>00141                 <a class="code" href="classAbstractDiagonalAligner.html#a0916641a69407ed9cfbed63f4a827538" title="This function reads the bottom-left cell from aligner and dispatch it to the MASA-Core.">flushLastCell</a>();
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <span class="comment">/* Statistics */</span>
<a name="l00145"></a>00145         <span class="keywordtype">int</span> b0 = max(0, <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> - (<a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a> - <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>));
<a name="l00146"></a>00146         <span class="keywordtype">int</span> b1 = min(<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>, <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>);
<a name="l00147"></a>00147         <span class="keywordtype">int</span> jb0;
<a name="l00148"></a>00148         <span class="keywordtype">int</span> jb1;
<a name="l00149"></a>00149         <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a> += b1 - b0 + 1;
<a name="l00150"></a>00150         <a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a> += max(<a class="code" href="classAbstractDiagonalAligner.html#abfa3086a693e28c09d371ffaf5b34af7" title="First block of non-pruned window.">windowStart</a> - b0, 0);
<a name="l00151"></a>00151         <a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a> += max(b1 - <a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a> - 1, 0);
<a name="l00152"></a>00152         <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#add3c701ccfa96da85ebe2922beb8f1bf">getBlockPosition</a>(b0  , 0, NULL, &amp;jb0, NULL, NULL);
<a name="l00153"></a>00153         <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#add3c701ccfa96da85ebe2922beb8f1bf">getBlockPosition</a>(b1-1, 0, NULL, NULL, NULL, &amp;jb1);
<a name="l00154"></a>00154         <span class="keywordflow">if</span> (jb1 &gt; 0) {
<a name="l00155"></a>00155                 <a class="code" href="classAbstractDiagonalAligner.html#a6a0f38c6101f29c44320ae8f3af425a3" title="Total number of cells in the grid.">statTotalCells</a> += ((<span class="keywordtype">long</span> long)jb1-jb0)* <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>();
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>++;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">/**</span>
<a name="l00162"></a>00162 <span class="comment"> * Tests if we have more diagonals to be processed.</span>
<a name="l00163"></a>00163 <span class="comment"> * @return true if we have more diagonals.</span>
<a name="l00164"></a>00164 <span class="comment"> */</span>
<a name="l00165"></a><a class="code" href="classAbstractDiagonalAligner.html#a11e5e90e0e4acb796f4da06e96492d85">00165</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractDiagonalAligner.html#a11e5e90e0e4acb796f4da06e96492d85" title="Tests if we have more diagonals to be processed.">AbstractDiagonalAligner::hasMoreIterations</a>() {
<a name="l00166"></a>00166         <span class="keywordflow">return</span> <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> &lt; <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a>;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 <span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">/**</span>
<a name="l00170"></a>00170 <span class="comment"> * Finalizes the execution of the partition.</span>
<a name="l00171"></a>00171 <span class="comment"> */</span>
<a name="l00172"></a><a class="code" href="classAbstractDiagonalAligner.html#a6de98b3db936af952ada05aacab80c43">00172</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a6de98b3db936af952ada05aacab80c43" title="Finalizes the execution of the partition.">AbstractDiagonalAligner::finalizeIterations</a>() {
<a name="l00173"></a>00173         <a class="code" href="classAbstractDiagonalAligner.html#ad177ea6941a29b293b3da2a0bbace702" title="Executes finalization procedures after the last diagonal is processed.">finalizeDiagonals</a>(); <span class="comment">// calls subclass</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keyword">delete</span> <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>;
<a name="l00176"></a>00176         <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a> = NULL;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">/**</span>
<a name="l00180"></a>00180 <span class="comment"> * Configures the grid for the given partition.</span>
<a name="l00181"></a>00181 <span class="comment"> * @param partition partition to be aligned.</span>
<a name="l00182"></a>00182 <span class="comment"> */</span>
<a name="l00183"></a><a class="code" href="classAbstractDiagonalAligner.html#adc8e86cf8aa1f1064f473b2930165495">00183</a> <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractDiagonalAligner.html#adc8e86cf8aa1f1064f473b2930165495" title="Configures the grid for the given partition.">AbstractDiagonalAligner::configureGrid</a>(<a class="code" href="classPartition.html">Partition</a> partition) {
<a name="l00184"></a>00184         <span class="comment">/* creates the grid */</span>
<a name="l00185"></a>00185         <a class="code" href="classGrid.html">Grid</a>* <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a> = this-&gt;<a class="code" href="classAbstractAligner.html#a10740e19e79a256a6e8459b43bf8b30d" title="Creates a new grid using the given partition coordinates.">createGrid</a>(partition);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         this-&gt;<a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a> = <a class="code" href="classAbstractDiagonalAligner.html#aa965574a866eb556e22c9c38d7bb5b27" title="Returns the number of horizontal blocks that the grid must have for a given width partition...">getGridWidth</a>(partition.<a class="code" href="classPartition.html#a16b1dd129f2e73210592748b00c148a6">getWidth</a>());
<a name="l00188"></a>00188         grid-&gt;<a class="code" href="classGrid.html#afbd38a26067aafa773f25f1fd5ab5d2c">setBlockHeight</a>(<a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>());
<a name="l00189"></a>00189         grid-&gt;<a class="code" href="classGrid.html#a17b9c9e0d698b7c16d430fb5c478ff7c" title="Splits the grid in $count$ positions (horizontal).">splitGridHorizontally</a>(<a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">/* grid statistics */</span>
<a name="l00192"></a>00192         <a class="code" href="classAbstractDiagonalAligner.html#a57624882591232c3f122b78d3715d515" title="Maintains the minimum gridWidth used.">statMinGridWidth</a>  = std::min(<a class="code" href="classAbstractDiagonalAligner.html#a57624882591232c3f122b78d3715d515" title="Maintains the minimum gridWidth used.">statMinGridWidth</a> , <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>);
<a name="l00193"></a>00193         <a class="code" href="classAbstractDiagonalAligner.html#a1fd95a37dccb4cf2042b2710bdb01904" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a>  = std::max(<a class="code" href="classAbstractDiagonalAligner.html#a1fd95a37dccb4cf2042b2710bdb01904" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a> , <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (<a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;Configured Grid width: %d\n&quot;</span>, <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>);
<a name="l00196"></a>00196         <span class="keywordflow">return</span> <a class="code" href="classAbstractAligner.html#aca1c60bfe8e3fa3bce1984d818f93fbb" title="The processing grid.">grid</a>;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="comment"></span>
<a name="l00200"></a>00200 <span class="comment">/**</span>
<a name="l00201"></a>00201 <span class="comment"> * @copydoc IAligner::clearStatistics</span>
<a name="l00202"></a>00202 <span class="comment"> */</span>
<a name="l00203"></a><a class="code" href="classAbstractDiagonalAligner.html#a108ed1c97ffa02c573d19c141714d3d4">00203</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a108ed1c97ffa02c573d19c141714d3d4">AbstractDiagonalAligner::clearStatistics</a>() {
<a name="l00204"></a>00204         <a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a> = 0;
<a name="l00205"></a>00205         <a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a> = 0;
<a name="l00206"></a>00206         <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a> = 0;
<a name="l00207"></a>00207         <a class="code" href="classAbstractDiagonalAligner.html#a6a0f38c6101f29c44320ae8f3af425a3" title="Total number of cells in the grid.">statTotalCells</a> = 0;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <a class="code" href="classAbstractDiagonalAligner.html#a57624882591232c3f122b78d3715d515" title="Maintains the minimum gridWidth used.">statMinGridWidth</a> = <a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00210"></a>00210         <a class="code" href="classAbstractDiagonalAligner.html#a1fd95a37dccb4cf2042b2710bdb01904" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a> = 0;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 <span class="comment"></span>
<a name="l00213"></a>00213 <span class="comment">/** Empty stub for the superclass virtual method.</span>
<a name="l00214"></a>00214 <span class="comment"> * @copydoc IAligner::clearStatistics</span>
<a name="l00215"></a>00215 <span class="comment"> */</span>
<a name="l00216"></a><a class="code" href="classAbstractDiagonalAligner.html#ad4d97ea2fe5ff6f9fc05eb09384b23e8">00216</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#ad4d97ea2fe5ff6f9fc05eb09384b23e8" title="Empty stub for the superclass virtual method.">AbstractDiagonalAligner::printInitialStatistics</a>(FILE* file) {
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 <span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">/** Empty stub for the superclass virtual method.</span>
<a name="l00220"></a>00220 <span class="comment"> * @copydoc IAligner::printStageStatistics</span>
<a name="l00221"></a>00221 <span class="comment"> */</span>
<a name="l00222"></a><a class="code" href="classAbstractDiagonalAligner.html#a317ada0e588621bcd6b47c6dd7c45645">00222</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a317ada0e588621bcd6b47c6dd7c45645" title="Empty stub for the superclass virtual method.">AbstractDiagonalAligner::printStageStatistics</a>(FILE* file) {
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 <span class="comment"></span>
<a name="l00225"></a>00225 <span class="comment">/** Empty stub for the superclass virtual method.</span>
<a name="l00226"></a>00226 <span class="comment"> * @copydoc IAligner::printFinalStatistics</span>
<a name="l00227"></a>00227 <span class="comment"> */</span>
<a name="l00228"></a><a class="code" href="classAbstractDiagonalAligner.html#a8f6f1f39fb2e8791c5190da0c413e5b7">00228</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a8f6f1f39fb2e8791c5190da0c413e5b7" title="Empty stub for the superclass virtual method.">AbstractDiagonalAligner::printFinalStatistics</a>(FILE* file) {
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 <span class="comment"></span>
<a name="l00231"></a>00231 <span class="comment">/**</span>
<a name="l00232"></a>00232 <span class="comment"> * Prints the pruning statistics and grid width used range.</span>
<a name="l00233"></a>00233 <span class="comment"> * @param file handler to print out the statistics.</span>
<a name="l00234"></a>00234 <span class="comment"> * @see IAligner::printStatistics</span>
<a name="l00235"></a>00235 <span class="comment"> */</span>
<a name="l00236"></a><a class="code" href="classAbstractDiagonalAligner.html#affcaee44c52621bb510d95fa61824478">00236</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#affcaee44c52621bb510d95fa61824478" title="Prints the pruning statistics and grid width used range.">AbstractDiagonalAligner::printStatistics</a>(FILE* file) {
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         fprintf(file, <span class="stringliteral">&quot;\n=====  PRUNING STATS   =====\n&quot;</span>);
<a name="l00239"></a>00239         fprintf(file, <span class="stringliteral">&quot;Pruned Blocks: %d = %d + %d\n&quot;</span>,
<a name="l00240"></a>00240                         <a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a>+<a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a>,
<a name="l00241"></a>00241                         <a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a>,
<a name="l00242"></a>00242                         <a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a>);
<a name="l00243"></a>00243         fprintf(file, <span class="stringliteral">&quot;Pruned Blocks: %.4f = %.4f + %.4f\n&quot;</span>,
<a name="l00244"></a>00244                         ((<a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a>+<a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a>) * 100.0f) / <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a>,
<a name="l00245"></a>00245                         (<a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a> * 100.0f) / <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a>,
<a name="l00246"></a>00246                         (<a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a> * 100.0f) / <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a>);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         fprintf(file, <span class="stringliteral">&quot;\n===== RUNTIME VARIABLES =====\n&quot;</span>);
<a name="l00249"></a>00249         fprintf(file, <span class="stringliteral">&quot;     Block Count: %d-%d\n&quot;</span>, <a class="code" href="classAbstractDiagonalAligner.html#a57624882591232c3f122b78d3715d515" title="Maintains the minimum gridWidth used.">statMinGridWidth</a>, <a class="code" href="classAbstractDiagonalAligner.html#a1fd95a37dccb4cf2042b2710bdb01904" title="Maintains the maximum gridWidth used.">statMaxGridWidth</a>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         fflush(file);
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 <span class="comment"></span>
<a name="l00254"></a>00254 <span class="comment">/**</span>
<a name="l00255"></a>00255 <span class="comment"> * Returns the number of processed cells since the last call to</span>
<a name="l00256"></a>00256 <span class="comment"> * AbstractDiagonalAligner::clearStatistics method.</span>
<a name="l00257"></a>00257 <span class="comment"> *</span>
<a name="l00258"></a>00258 <span class="comment"> * @return number of processed cells</span>
<a name="l00259"></a>00259 <span class="comment"> */</span>
<a name="l00260"></a><a class="code" href="classAbstractDiagonalAligner.html#a893873e2fd8bc0c5de56384d25333939">00260</a> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classAbstractDiagonalAligner.html#a893873e2fd8bc0c5de56384d25333939" title="Returns the number of processed cells since the last call to AbstractDiagonalAligner::clearStatistics...">AbstractDiagonalAligner::getProcessedCells</a>() {
<a name="l00261"></a>00261         <span class="keywordflow">return</span> <a class="code" href="classAbstractDiagonalAligner.html#a6a0f38c6101f29c44320ae8f3af425a3" title="Total number of cells in the grid.">statTotalCells</a>;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 <span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">/**</span>
<a name="l00265"></a>00265 <span class="comment"> * MASA-Core prints this string periodically.</span>
<a name="l00266"></a>00266 <span class="comment"> * @return the string to be printed.</span>
<a name="l00267"></a>00267 <span class="comment"> */</span>
<a name="l00268"></a><a class="code" href="classAbstractDiagonalAligner.html#a7399e0cf7ba8dfda4f2635064add1428">00268</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classAbstractDiagonalAligner.html#a7399e0cf7ba8dfda4f2635064add1428" title="MASA-Core prints this string periodically.">AbstractDiagonalAligner::getProgressString</a>()<span class="keyword"> const </span>{
<a name="l00269"></a>00269         <span class="keyword">static</span> <span class="keywordtype">char</span> str[128];
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         sprintf(str, <span class="stringliteral">&quot;PROGRESS: %4d/%4d  cut:%d/%d (%d/%d %.1f%% %.1f%%)&quot;</span>,
<a name="l00272"></a>00272                         <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>, <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a>,
<a name="l00273"></a>00273                         <a class="code" href="classAbstractDiagonalAligner.html#abfa3086a693e28c09d371ffaf5b34af7" title="First block of non-pruned window.">windowStart</a>, <a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a>,
<a name="l00274"></a>00274                         this-&gt;<a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a>, this-&gt;<a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a>,
<a name="l00275"></a>00275                         (this-&gt;<a class="code" href="classAbstractDiagonalAligner.html#ac7807adc7d2ba1af3a79a93193dee24b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksLeft</a> * 100.0f) / <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a>,
<a name="l00276"></a>00276                 (this-&gt;<a class="code" href="classAbstractDiagonalAligner.html#a9b11ad0ccb92076e23fc379d4a4f552b" title="Number of pruned blocks in the left side of the grid.">statPrunedBlocksRight</a> * 100.0f) / <a class="code" href="classAbstractDiagonalAligner.html#a3165397996c7e5cf0fc40b6b1f4e735d" title="Total number of blocks containing in the grid.">statTotalBlocks</a>);
<a name="l00277"></a>00277         <span class="keywordflow">return</span> str;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 <span class="comment"></span>
<a name="l00280"></a>00280 <span class="comment">/**</span>
<a name="l00281"></a>00281 <span class="comment"> * Iterates on the blocks and check if any of them must flush its last row</span>
<a name="l00282"></a>00282 <span class="comment"> * in the disk. If so, the row is copied from the aligner and dispatched to the</span>
<a name="l00283"></a>00283 <span class="comment"> * MASA-Core. Note that the blocks are disposed in a diagonal, so there may</span>
<a name="l00284"></a>00284 <span class="comment"> * be a maximum of one block per special row.</span>
<a name="l00285"></a>00285 <span class="comment"> */</span>
<a name="l00286"></a><a class="code" href="classAbstractDiagonalAligner.html#ab806746910e21bd01702477bb0b1995e">00286</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#ab806746910e21bd01702477bb0b1995e" title="Iterates on the blocks and check if any of them must flush its last row in the disk.">AbstractDiagonalAligner::flushSpecialRows</a>() {
<a name="l00287"></a>00287         <span class="keywordflow">if</span> (<a class="code" href="classAbstractAligner.html#a1446002ca4fe9bfb0ff89983878b46e3" title="Delegates to IManager::getSpecialRowInterval()">getSpecialRowInterval</a>() &gt; 0) {
<a name="l00288"></a>00288                 <span class="keyword">const</span> <span class="keywordtype">int</span> blockHeight = <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>();
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="keywordflow">if</span> (<a class="code" href="classAbstractDiagonalAligner.html#a23bf42da2e5db8607a24be1a86e2b770" title="Defines if the blocks in row $by$ must flush their last row.">isSpecialRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>+1)) {
<a name="l00291"></a>00291                 <span class="comment">/*</span>
<a name="l00292"></a>00292 <span class="comment">                 * Dispatches the first cell of the row, that is copied from</span>
<a name="l00293"></a>00293 <span class="comment">                 * the first column (firstColumnTail).</span>
<a name="l00294"></a>00294 <span class="comment">                 */</span>
<a name="l00295"></a>00295                 <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a> first_cell = <a class="code" href="classAbstractAligner.html#a3e3481cc1165a604d7cb4a1f2c00235a">getFirstColumnTail</a>();
<a name="l00296"></a>00296                 first_cell.<a class="code" href="structcell__t.html#ab947d4f4b47217e901f558eab8025bd2">f</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00297"></a>00297                 <a class="code" href="classAbstractAligner.html#afd41f4b27ddd415d1cb8ab1318d8be17" title="Delegates to IManager::dispatchRow()">dispatchRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>()+(<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>+1)*blockHeight, &amp;first_cell, 1);
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a> &amp;&amp; k &lt;= <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>; k++) {
<a name="l00301"></a>00301                         <span class="keywordtype">int</span> bx = k;
<a name="l00302"></a>00302                         <span class="keywordtype">int</span> by = <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> - bx;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                         <span class="keywordflow">if</span> (<a class="code" href="classAbstractDiagonalAligner.html#a23bf42da2e5db8607a24be1a86e2b770" title="Defines if the blocks in row $by$ must flush their last row.">isSpecialRow</a>(by)) { <span class="comment">// Check if this block must be flushed</span>
<a name="l00305"></a>00305                                 <span class="keywordtype">int</span> i = by * blockHeight;
<a name="l00306"></a>00306                                 <span class="keywordtype">int</span> x0;
<a name="l00307"></a>00307                                 <span class="keywordtype">int</span> x1;
<a name="l00308"></a>00308                                 <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#add3c701ccfa96da85ebe2922beb8f1bf">getBlockPosition</a>(bx, 0, NULL, &amp;x0, NULL, &amp;x1);
<a name="l00309"></a>00309                                 <span class="keywordtype">int</span> xLen = x1 - x0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311                                 <span class="keyword">const</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>* specialRow = <a class="code" href="classAbstractDiagonalAligner.html#a98b54e96a235b344e907e7da39d0d803" title="Returns the bottom-most cells of a block computed from the previous computed diagonal.">getSpecialRow</a>(x0, xLen); <span class="comment">// from subclass</span>
<a name="l00312"></a>00312                                 <a class="code" href="classAbstractAligner.html#afd41f4b27ddd415d1cb8ab1318d8be17" title="Delegates to IManager::dispatchRow()">dispatchRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>() + i, specialRow, xLen);
<a name="l00313"></a>00313                         }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315                 }
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 <span class="comment"></span>
<a name="l00319"></a>00319 <span class="comment">/**</span>
<a name="l00320"></a>00320 <span class="comment"> * This function reads a chunk of the last row from the aligner and dispatch</span>
<a name="l00321"></a>00321 <span class="comment"> * it to the MASA-Core. This method is called multiple times during the</span>
<a name="l00322"></a>00322 <span class="comment"> * last external diagonals, since each of the bottom-most blocks</span>
<a name="l00323"></a>00323 <span class="comment"> * calculates a range of the last row.</span>
<a name="l00324"></a>00324 <span class="comment"> */</span>
<a name="l00325"></a><a class="code" href="classAbstractDiagonalAligner.html#a215586a2aa9fc0deca2d9c9abef82cbb">00325</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a215586a2aa9fc0deca2d9c9abef82cbb" title="This function reads a chunk of the last row from the aligner and dispatch it to the MASA-Core...">AbstractDiagonalAligner::flushLastRow</a>() {
<a name="l00326"></a>00326         <span class="keywordflow">if</span> (<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> &gt;= <a class="code" href="classAbstractDiagonalAligner.html#ab5a4092447af68aa2f1b27cf85157f23" title="number of rows of blocks">gridHeight</a>-1) {
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 1; k &lt;= <a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a> &amp;&amp; k &lt;= <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>; k++) {
<a name="l00329"></a>00329                         <span class="keywordtype">int</span> bx = k;
<a name="l00330"></a>00330                         <span class="keyword">const</span> <span class="keywordtype">int</span> by = <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> - bx;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332                         <span class="keywordtype">bool</span> flushThisRow = (by == <a class="code" href="classAbstractDiagonalAligner.html#ab5a4092447af68aa2f1b27cf85157f23" title="number of rows of blocks">gridHeight</a>-1);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                         <span class="keywordflow">if</span> (flushThisRow) {
<a name="l00335"></a>00335                                 <span class="keywordtype">int</span> x0;
<a name="l00336"></a>00336                                 <span class="keywordtype">int</span> x1;
<a name="l00337"></a>00337                                 <a class="code" href="classAbstractAligner.html#a3448cc3cba9423a8758f4d677eac67e5" title="Returns the grid created by the last call to the AbstractAligner::createGrid method.">getGrid</a>()-&gt;<a class="code" href="classGrid.html#add3c701ccfa96da85ebe2922beb8f1bf">getBlockPosition</a>(bx-1, 0, NULL, &amp;x0, NULL, &amp;x1);
<a name="l00338"></a>00338                                 <span class="keywordtype">int</span> xLen = x1 - x0;
<a name="l00339"></a>00339                                 <span class="keyword">const</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>* lastRow = <a class="code" href="classAbstractDiagonalAligner.html#a07fd0875cdc124e72327c56755a03b3a" title="Returns the cells in the interval $[j,j+len)$ of the bottom-most row.">getLastRow</a>(x0, xLen); <span class="comment">// from subclass</span>
<a name="l00340"></a>00340                                 <span class="keywordflow">if</span> (<a class="code" href="AbstractDiagonalAligner_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83" title="Set to (1) in order to print debug information in the stdout.">DEBUG</a>) printf(<span class="stringliteral">&quot;dispatchRow: %d..%d %d %d\n&quot;</span>, x0, x1, xLen, bx);
<a name="l00341"></a>00341                                 <span class="keywordflow">if</span> (bx == 1) {
<a name="l00342"></a>00342                                         <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a> first_cell = <a class="code" href="classAbstractAligner.html#a3e3481cc1165a604d7cb4a1f2c00235a">getFirstColumnTail</a>();
<a name="l00343"></a>00343                                         first_cell.<a class="code" href="structcell__t.html#ab947d4f4b47217e901f558eab8025bd2">f</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00344"></a>00344                                 <a class="code" href="classAbstractAligner.html#afd41f4b27ddd415d1cb8ab1318d8be17" title="Delegates to IManager::dispatchRow()">dispatchRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>(), &amp;first_cell, 1);
<a name="l00345"></a>00345                                 }
<a name="l00346"></a>00346                                 <a class="code" href="classAbstractAligner.html#afd41f4b27ddd415d1cb8ab1318d8be17" title="Delegates to IManager::dispatchRow()">dispatchRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>(), lastRow, xLen);
<a name="l00347"></a>00347                         }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                 }
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 <span class="comment"></span>
<a name="l00353"></a>00353 <span class="comment">/**</span>
<a name="l00354"></a>00354 <span class="comment"> * This function reads a chunk of the last column from the aligner and dispatch</span>
<a name="l00355"></a>00355 <span class="comment"> * it to the MASA-Core. This method is called once for each external diagonal,</span>
<a name="l00356"></a>00356 <span class="comment"> * since the last block is always calculating a new chunk of the last column.</span>
<a name="l00357"></a>00357 <span class="comment"> */</span>
<a name="l00358"></a><a class="code" href="classAbstractDiagonalAligner.html#a2fa88132695eb2768f0d280f2dcbcc57">00358</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a2fa88132695eb2768f0d280f2dcbcc57" title="This function reads a chunk of the last column from the aligner and dispatch it to the MASA-Core...">AbstractDiagonalAligner::flushLastColumn</a>() {
<a name="l00359"></a>00359         <span class="keyword">const</span> <span class="keywordtype">int</span> blockHeight = <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>();
<a name="l00360"></a>00360         <span class="keywordtype">int</span> i = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>() + (<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>-<a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>)*blockHeight;
<a name="l00361"></a>00361         <span class="keywordflow">if</span> (i &gt;= <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a73421be777c0f722e96c655db68e9eca">getI0</a>()) {
<a name="l00362"></a>00362                 <span class="keywordtype">int</span> len = <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>();
<a name="l00363"></a>00363                 <span class="keywordflow">if</span> (i+len &gt; <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>()) {
<a name="l00364"></a>00364                         len = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>()-i;
<a name="l00365"></a>00365                 }
<a name="l00366"></a>00366                 <span class="keyword">const</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>* column_chunk = <a class="code" href="classAbstractDiagonalAligner.html#a14f71c3922f2dcf8278553aeee426300" title="Returns the cells in the interval $[i,i+len)$ of the bottom-most row.">getLastColumn</a>(i, len); <span class="comment">// from subclass</span>
<a name="l00367"></a>00367                 <a class="code" href="classAbstractAligner.html#a2816e1a632ea9739497ad1298b9348d7" title="Delegates to IManager::dispatchColumn()">dispatchColumn</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>(), column_chunk, len);
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 <span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment">/**</span>
<a name="l00372"></a>00372 <span class="comment"> * This function reads the bottom-left cell from aligner and dispatch it</span>
<a name="l00373"></a>00373 <span class="comment"> * to the MASA-Core.</span>
<a name="l00374"></a>00374 <span class="comment"> */</span>
<a name="l00375"></a><a class="code" href="classAbstractDiagonalAligner.html#a0916641a69407ed9cfbed63f4a827538">00375</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a0916641a69407ed9cfbed63f4a827538" title="This function reads the bottom-left cell from aligner and dispatch it to the MASA-Core.">AbstractDiagonalAligner::flushLastCell</a>() {
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>+1 &gt;= <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a>) { <span class="comment">// last iteration</span>
<a name="l00377"></a>00377                 <span class="keyword">const</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>* lastCell = <a class="code" href="classAbstractDiagonalAligner.html#a07fd0875cdc124e72327c56755a03b3a" title="Returns the cells in the interval $[j,j+len)$ of the bottom-most row.">getLastRow</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>()-1, 1); <span class="comment">// from subclass</span>
<a name="l00378"></a>00378 
<a name="l00379"></a>00379                 <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a> score;
<a name="l00380"></a>00380                 score.<a class="code" href="structscore__t.html#a92c1b6f8c1e838fbe605b3826f569811" title="i-coordinate of the score">i</a> = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#aa48944e830d980f67ebadd615ca17913">getI1</a>()-1;
<a name="l00381"></a>00381                 score.j = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>()-1;
<a name="l00382"></a>00382                 score.score = lastCell-&gt;<a class="code" href="structcell__t.html#a32cac3d952a676d4ebfa39283e1d9f09">h</a>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384                 <a class="code" href="classAbstractAligner.html#abb033d4cb32f8ab42e2ca5d6bbdf9117" title="Delegates to IManager::dispatchScore()">dispatchScore</a>(score);
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 <span class="comment"></span>
<a name="l00388"></a>00388 <span class="comment">/**</span>
<a name="l00389"></a>00389 <span class="comment"> * This function reads the block scores from aligner and dispatch them</span>
<a name="l00390"></a>00390 <span class="comment"> * to the MASA-Core.</span>
<a name="l00391"></a>00391 <span class="comment"> */</span>
<a name="l00392"></a><a class="code" href="classAbstractDiagonalAligner.html#ad23c6cf321dd2498d69e225e16fd9fc3">00392</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#ad23c6cf321dd2498d69e225e16fd9fc3" title="This function reads the block scores from aligner and dispatch them to the MASA-Core.">AbstractDiagonalAligner::flushBlockScores</a>() {
<a name="l00393"></a>00393         <span class="keyword">const</span> <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a>* scores = <a class="code" href="classAbstractDiagonalAligner.html#aa0df9454f0c21fa5b66a6b8cfded8895" title="Returns the best scores of the blocks from the last computed diagonal.">getBlockScores</a>(); <span class="comment">// from subclass</span>
<a name="l00394"></a>00394         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bl=0; bl&lt;<a class="code" href="classAbstractDiagonalAligner.html#a0e6c7dc7ef23a9335e4db0fa15cbad38" title="number of columns of blocks">gridWidth</a>; bl++) {
<a name="l00395"></a>00395                 <span class="keywordtype">int</span> x = bl;
<a name="l00396"></a>00396                 <span class="keywordtype">int</span> y = <a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a> - bl;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398                 <span class="keywordflow">if</span> (y &gt;= 0 &amp;&amp; y &lt; <a class="code" href="classAbstractDiagonalAligner.html#aebef0bb4aabbbb84720642020de5e148" title="Number of external diagonals to be processed in the current partition.">externalDiagonalCount</a>) {
<a name="l00399"></a>00399                         <span class="comment">// Dispatch scores for each valid block</span>
<a name="l00400"></a>00400                         <a class="code" href="classAbstractAligner.html#abb033d4cb32f8ab42e2ca5d6bbdf9117" title="Delegates to IManager::dispatchScore()">dispatchScore</a>(scores[bl], x, y);
<a name="l00401"></a>00401                 }
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 <span class="comment"></span>
<a name="l00405"></a>00405 <span class="comment">/**</span>
<a name="l00406"></a>00406 <span class="comment"> * Initialize the first row of the aligner with the cells received</span>
<a name="l00407"></a>00407 <span class="comment"> * from the MASA-Core. The first row is read all at once.</span>
<a name="l00408"></a>00408 <span class="comment"> */</span>
<a name="l00409"></a><a class="code" href="classAbstractDiagonalAligner.html#a7a4a0e27d3ba4da77ccef3a471303644">00409</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#a7a4a0e27d3ba4da77ccef3a471303644" title="Initialize the first row of the aligner with the cells received from the MASA-Core.">AbstractDiagonalAligner::loadFirstRow</a>() {
<a name="l00410"></a>00410         <span class="comment">// The seq1_offset allow us to reduce the memory usage.</span>
<a name="l00411"></a>00411         <span class="keywordtype">int</span> j0 = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a601c9fbb85bce38451c5272f7271b767">getJ0</a>();
<a name="l00412"></a>00412         <span class="keywordtype">int</span> j1 = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>();
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         <span class="keywordtype">int</span> chunk_size = j1+10; <span class="comment">// TODO optimize</span>
<a name="l00415"></a>00415         <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>* chunk = (<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*)malloc(chunk_size*<span class="keyword">sizeof</span>(<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>));
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <a class="code" href="classAbstractAligner.html#a3b0b4d7e643f8d58a8887593070d021d" title="Delegates to IManager::receiveFirstRow()">receiveFirstRow</a>((<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*) ((chunk + j0)), j1 - j0); <span class="comment">// from MASA-Core</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="comment">// The 1st cell of the last column is the last cell of the first row.</span>
<a name="l00420"></a>00420         <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a> first_cell = <a class="code" href="classAbstractAligner.html#ae0ad0b613030f3fceeb32c40a6d70d5f">getFirstRowTail</a>();
<a name="l00421"></a>00421         first_cell.<a class="code" href="structcell__t.html#ab947d4f4b47217e901f558eab8025bd2">f</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00422"></a>00422         <a class="code" href="classAbstractAligner.html#a2816e1a632ea9739497ad1298b9348d7" title="Delegates to IManager::dispatchColumn()">dispatchColumn</a>(<a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#afbc1db1f908eedefa9ee5c483f5ddd8a">getJ1</a>(), &amp;first_cell, 1);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <a class="code" href="classAbstractDiagonalAligner.html#af77917296c13e936bbc76233ffe95ad6" title="Initializes the cells in the range $[j,j+len)$ of the first row.">setFirstRow</a>((<span class="keyword">const</span> <a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*)&amp;chunk[j0], j0, j1-j0); <span class="comment">// to subclass</span>
<a name="l00425"></a>00425         <span class="keyword">delete</span> chunk;
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 <span class="comment"></span>
<a name="l00428"></a>00428 <span class="comment">/**</span>
<a name="l00429"></a>00429 <span class="comment"> * Initialize the first column of the aligner with the cells received</span>
<a name="l00430"></a>00430 <span class="comment"> * from the MASA-Core. The first column is read in</span>
<a name="l00431"></a>00431 <span class="comment"> * chunks, which size is defined by the getBlockHeight() function.</span>
<a name="l00432"></a>00432 <span class="comment"> */</span>
<a name="l00433"></a><a class="code" href="classAbstractDiagonalAligner.html#afb626662cdbce5f854800e9c8cf9ffc4">00433</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#afb626662cdbce5f854800e9c8cf9ffc4" title="Initialize the first column of the aligner with the cells received from the MASA-Core.">AbstractDiagonalAligner::loadFirstColumn</a>() {
<a name="l00434"></a>00434         <span class="keywordtype">int</span> pos_i = ((<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>)*<a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>());
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (pos_i &lt; <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>()) {
<a name="l00436"></a>00436         <span class="keywordtype">int</span> len = <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>(); <span class="comment">// from subclass</span>
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (pos_i + len &gt;= <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>()) {
<a name="l00438"></a>00438                 len = <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>() - pos_i;
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="comment">/* Puts the H[i-1][j-1] dependency in the first cell of the column. */</span>
<a name="l00442"></a>00442         <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>[0] = <a class="code" href="classAbstractAligner.html#a3e3481cc1165a604d7cb4a1f2c00235a">getFirstColumnTail</a>();
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">/* Receives the first column chunk from the MASA-core */</span>
<a name="l00445"></a>00445         <a class="code" href="classAbstractAligner.html#a5826f966c44d93208b7b8da6763f3eb6" title="Delegates to IManager::receiveFirstColumn()">receiveFirstColumn</a>((<a class="code" href="structcell__t.html" title="Struct that represents a cell in the DP matrix.">cell_t</a>*) (<a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>+1), len); <span class="comment">// from MASA-Core</span>
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                 <span class="comment">/* Padding */</span>
<a name="l00448"></a>00448                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = len; i &lt; <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>(); i++) {
<a name="l00449"></a>00449                         <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>[i].<a class="code" href="structcell__t.html#a32cac3d952a676d4ebfa39283e1d9f09">h</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00450"></a>00450                         <a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>[i].<a class="code" href="structcell__t.html#a4a444129d5b4187e3b699efa46f33601">e</a> = -<a class="code" href="libmasaTypes_8hpp.html#a12c2040f25d8e3a7b9e1c2024c618cb6" title="Infinity number used in the cells of the DP matrix.">INF</a>;
<a name="l00451"></a>00451                 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453                 <span class="comment">/* Updates the first column in GPU */</span>
<a name="l00454"></a>00454                 <a class="code" href="classAbstractDiagonalAligner.html#a9682215f660dfcd5b26aa173bdfcba6c" title="Initializes the cells in the range $[i,i+len)$ of the first column.">setFirstColumn</a>(<a class="code" href="classAbstractDiagonalAligner.html#aa21b057ae3c59b4fb2875fffbc1e431c" title="Vector used to store the cells of the first column.">h_loadColumn</a>, pos_i, len); <span class="comment">// to subclass</span>
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment"></span>
<a name="l00459"></a>00459 <span class="comment">/**</span>
<a name="l00460"></a>00460 <span class="comment"> * Defines if the blocks in row $by$ must flush their last row. The top-most</span>
<a name="l00461"></a>00461 <span class="comment"> * and bottom-most rows are never special rows.</span>
<a name="l00462"></a>00462 <span class="comment"> *</span>
<a name="l00463"></a>00463 <span class="comment"> * @param by the block&#39;s row id</span>
<a name="l00464"></a>00464 <span class="comment"> * @return true if the blocks inr row $by$ must save their last row.</span>
<a name="l00465"></a>00465 <span class="comment"> */</span>
<a name="l00466"></a><a class="code" href="classAbstractDiagonalAligner.html#a23bf42da2e5db8607a24be1a86e2b770">00466</a> <span class="keywordtype">bool</span> <a class="code" href="classAbstractDiagonalAligner.html#a23bf42da2e5db8607a24be1a86e2b770" title="Defines if the blocks in row $by$ must flush their last row.">AbstractDiagonalAligner::isSpecialRow</a>(<span class="keywordtype">int</span> by) {
<a name="l00467"></a>00467         <span class="keyword">const</span> <span class="keywordtype">int</span> block_height = <a class="code" href="classAbstractDiagonalAligner.html#a2cff74d6d15b6d0bc75ea989cef3fca1" title="Returns the default height of each block.">getBlockHeight</a>();
<a name="l00468"></a>00468         <span class="keywordtype">int</span> flush_block_interval = (<a class="code" href="classAbstractAligner.html#a1446002ca4fe9bfb0ff89983878b46e3" title="Delegates to IManager::getSpecialRowInterval()">getSpecialRowInterval</a>()+block_height-1)/block_height;
<a name="l00469"></a>00469         <span class="keywordflow">if</span> (flush_block_interval &lt;= 0) {
<a name="l00470"></a>00470                 flush_block_interval = 1;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (flush_block_interval &lt;= <a class="code" href="AbstractDiagonalAligner_8cpp.html#a5fd5a7f32ea0cbbdb19f5c783bda48ad" title="Defines a lower-bound flush interval between two special rows.">MINIMUM_FLUSH_INTERVAL</a>/block_height) {
<a name="l00473"></a>00473                 flush_block_interval = <a class="code" href="AbstractDiagonalAligner_8cpp.html#a5fd5a7f32ea0cbbdb19f5c783bda48ad" title="Defines a lower-bound flush interval between two special rows.">MINIMUM_FLUSH_INTERVAL</a>/block_height;
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="keywordtype">int</span> i = by * block_height;
<a name="l00477"></a>00477         <span class="keywordflow">return</span> ((by % flush_block_interval == 0) &amp;&amp; (i &gt; 0 &amp;&amp; i &lt; <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>.<a class="code" href="classPartition.html#a79a244debf8cd8f1373a89ef7e78be83">getHeight</a>()) );
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 <span class="comment"></span>
<a name="l00480"></a>00480 <span class="comment">/**</span>
<a name="l00481"></a>00481 <span class="comment"> * Returns the partition currently being processed.</span>
<a name="l00482"></a>00482 <span class="comment"> * @return the partition currently being processed.</span>
<a name="l00483"></a>00483 <span class="comment"> */</span>
<a name="l00484"></a><a class="code" href="classAbstractDiagonalAligner.html#aadf949389fa55efb9177d6ee643f391b">00484</a> <a class="code" href="classPartition.html">Partition</a> <a class="code" href="classAbstractDiagonalAligner.html#aadf949389fa55efb9177d6ee643f391b" title="Returns the partition currently being processed.">AbstractDiagonalAligner::getPartition</a>()<span class="keyword"> const </span>{
<a name="l00485"></a>00485         <span class="keywordflow">return</span> <a class="code" href="classAbstractDiagonalAligner.html#ad12d390e4e1a599d08965586d1034f12" title="The partition currently being processed.">partition</a>;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 <span class="comment"></span>
<a name="l00488"></a>00488 <span class="comment">/**</span>
<a name="l00489"></a>00489 <span class="comment"> * Updates the pruning window accordingly to the last block scores.</span>
<a name="l00490"></a>00490 <span class="comment"> */</span>
<a name="l00491"></a><a class="code" href="classAbstractDiagonalAligner.html#ae4a7f35bf376916a0668c0ecbbd9778b">00491</a> <span class="keywordtype">void</span> <a class="code" href="classAbstractDiagonalAligner.html#ae4a7f35bf376916a0668c0ecbbd9778b" title="Updates the pruning window accordingly to the last block scores.">AbstractDiagonalAligner::pruneBlocks</a>() {
<a name="l00492"></a>00492         <span class="keyword">const</span> <a class="code" href="structscore__t.html" title="Represents a score in the DP matrix.">score_t</a>* block_scores = <a class="code" href="classAbstractDiagonalAligner.html#aa0df9454f0c21fa5b66a6b8cfded8895" title="Returns the best scores of the blocks from the last computed diagonal.">getBlockScores</a>();
<a name="l00493"></a>00493         <span class="keywordtype">int</span> prevStart;
<a name="l00494"></a>00494         <span class="keywordtype">int</span> prevEnd;
<a name="l00495"></a>00495         <a class="code" href="classAbstractDiagonalAligner.html#af7e78bd7886fcfa086198a03131875ee" title="Block Pruner object.">pruner</a>-&gt;<a class="code" href="classBlockPruningDiagonal.html#a9887625b9650373f488d4a62b2651301">getNonPrunableWindow</a>(&amp;prevStart, &amp;prevEnd);
<a name="l00496"></a>00496         <a class="code" href="classAbstractDiagonalAligner.html#af7e78bd7886fcfa086198a03131875ee" title="Block Pruner object.">pruner</a>-&gt;<a class="code" href="classBlockPruningDiagonal.html#a63b6874e2cfd76ff2ebdd450ab727377">updatePruningWindow</a>(<a class="code" href="classAbstractDiagonalAligner.html#a6462cbcae70b6b17c09bfafad97cdcd8" title="The id of the current external diagonal being processed.">currentExternalDiagonal</a>-1, block_scores);
<a name="l00497"></a>00497         <a class="code" href="classAbstractDiagonalAligner.html#af7e78bd7886fcfa086198a03131875ee" title="Block Pruner object.">pruner</a>-&gt;<a class="code" href="classBlockPruningDiagonal.html#a9887625b9650373f488d4a62b2651301">getNonPrunableWindow</a>(&amp;<a class="code" href="classAbstractDiagonalAligner.html#abfa3086a693e28c09d371ffaf5b34af7" title="First block of non-pruned window.">windowStart</a>, &amp;<a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a>);
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (<a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a> &lt; prevEnd) {
<a name="l00499"></a>00499                 <a class="code" href="classAbstractDiagonalAligner.html#a414a7c14d1407f7a7087315e2c198527" title="Clear the rows of the pruned blocks, in range $[b0,b1)$.">clearPrunedBlocks</a>(<a class="code" href="classAbstractDiagonalAligner.html#aee697b976563f9810a4e45695b81ac79" title="Last block of non-pruned window.">windowEnd</a>, prevEnd);
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri May 8 2015 11:39:19 for MASA-Core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
